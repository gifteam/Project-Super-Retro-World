<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>BeepBox</title>
	<meta name="description" content="BeepBox is an online tool for sketching and sharing chiptune melodies. " />
	<meta name="keywords" content="chiptune, music, melody, composition, tool, square wave, NES, NSF, BeepBox, beepbox" />
	<meta name="viewport" content="width=700">
	<meta name="apple-mobile-web-app-capable" content="yes"/>
	<meta name="apple-mobile-web-app-status-bar-style" content="black"/>
	<meta name="mobile-web-app-capable" content="yes"/>
	<meta name="format-detection" content="telephone=no">
	<style type="text/css">
div {
	margin: 0;
	padding: 0;
}
body {
	background: #000;
	font-family: sans-serif;
	font-size: medium;
	color: #fff;
}
h1 {
	font-size: 30px;
	text-align: center;
}
.centerDiv {
	margin: 0px auto;
}
a {
	color: #86f;
}
	</style>
</head>

<body>
<div class="centerDiv" style="width: 700px">
	
	<div id="beepboxEditorContainer" style="width: 700px; height: 645px;"></div>
	
	<h1>
		BeepBox Offline
	</h1>
	<p id="introduction">
		BeepBox is an online (and offline!) tool for sketching and sharing chiptune melodies. 
	</p>
	<p>
		All song data is packaged into the URL at the top of your browser. 
		When you make changes to the song, the URL is updated to reflect your changes. 
		When you are satisfied with your song, just copy and paste the URL to save and share your song! 
	</p>
	
	<h1>
		Instructions
	</h1>
	<p>
		You can add or remove notes by clicking on the gray rows at the top. 
		BeepBox automatically plays the notes out loud for you. Try it!
	</p>
	<p>
		Notes go into patterns, and you can edit one pattern at a time.
		Those numbered boxes at the bottom of the editor are the different patterns you can edit.
		Click the other boxes to move to a different part of the song, or click the arrows on the currently selected box to swap which pattern is played during that part of the song.
	</p>
	<p>
		There are four rows of patterns that BeepBox can play simultaneously, and each row has its own set of patterns. 
		The first three rows can play melodies and the bottom row is for drums.
	</p>
	<p>
		The purple loop underneath the numbered boxes controls which part of the song is currently repeating. 
		Move the loop to listen to a different part of the song, or drag the ends to expand the loop to include the whole song. 
	</p>
	<p>
		When BeepBox has focus (click on its interface above), you can use these keyboard shortcuts: <br/>
	</p>
	<p style="margin-left:50px;">
		Spacebar: Pause or Resume<br/>
		Z: Undo<br/>
		Y or Shift Z: Redo<br/>
		C: Copy the current pattern<br/>
		V: Paste the current pattern<br/>
		[ ]: Move the playhead backward and forward<br/>
		Arrow Keys: Change which bar is selected<br/>
		1-8: Reassign a pattern to the currently selected bar<br/>
	</p>
	<p>
		In the pattern editor, you can click and drag horizontally on a note to adjust its duration.
		You can also click above or below an existing note to enable a rapid arpeggio/trill effect, oscillating between two or more simultaneous notes. 
	</p>
	<p>
		ADVANCED: Drag vertically from an existing note to bend its pitch, or drag vertically from above or below the note to adjust its volume.
	</p>
	<p>
		BeepBox has many more features. 
		Try playing with the buttons and menus on the right side to find out what it can do!
	</p>
	<h1>
		About
	</h1>
	<p>
		BeepBox is developed by <a href="http://www.johnnesky.com">John Nesky</a>. 
	</p>
	<p>
		BeepBox does not claim ownership over songs created with it, so original songs belong to their authors. 
	</p>
	<p>
		Neither John Nesky nor BeepBox assume responsibility for any copyrighted material played on BeepBox. No songs are ever received, recorded, or distributed by BeepBox's servers. All song data is contained in the URL after the hash (#) mark, and BeepBox running inside your browser converts that data into sound waves.
	</p>
	<p>
		You can download and use <a href="https://bitbucket.org/shaktool/beepbox">the source code</a> under the MIT license.
	</p>
</div>

<script type="text/javascript">

var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},beepbox;!function(t){var e=function(){function t(t,e){this.$=[],this.aa=0;for(var n=0;n<e.length;n++){var s=t[e.charAt(n)];this.$.push(0!=(32&s)),this.$.push(0!=(16&s)),this.$.push(0!=(8&s)),this.$.push(0!=(4&s)),this.$.push(0!=(2&s)),this.$.push(0!=(1&s))}}return t.prototype.read=function(t){for(var e=0;t>0;)e<<=1,e+=this.$[this.aa++]?1:0,t--;return e},t.prototype.readLongTail=function(t,e){for(var n=t,s=e;this.$[this.aa++];)n+=1<<s,s++;for(;s>0;)s--,this.$[this.aa++]&&(n+=1<<s);return n},t.prototype.readPartDuration=function(){return this.readLongTail(1,2)},t.prototype.readPinCount=function(){return this.readLongTail(1,0)},t.prototype.readNoteInterval=function(){return this.read(1)?-this.readLongTail(1,3):this.readLongTail(1,3)},t}(),n=function(){function t(){this.$=[]}return t.prototype.write=function(t,e){for(t--;t>=0;)this.$.push(1==(e>>t&1)),t--},t.prototype.writeLongTail=function(t,e,n){if(t>n)throw new Error("value out of bounds");n-=t;for(var s=e;n>=1<<s;)this.$.push(!0),n-=1<<s,s++;for(this.$.push(!1);s>0;)s--,this.$.push(0!=(n&1<<s))},t.prototype.writePartDuration=function(t){this.writeLongTail(1,2,t)},t.prototype.writePinCount=function(t){this.writeLongTail(1,0,t)},t.prototype.writeNoteInterval=function(t){0>t?(this.write(1,1),this.writeLongTail(1,3,-t)):(this.write(1,0),this.writeLongTail(1,3,t))},t.prototype.concat=function(t){this.$=this.$.concat(t.$)},t.prototype.encodeBase64=function(t){for(var e="",n=0;n<this.$.length;n+=6){var s=0;this.$[n+0]&&(s+=32),this.$[n+1]&&(s+=16),this.$[n+2]&&(s+=8),this.$[n+3]&&(s+=4),this.$[n+4]&&(s+=2),this.$[n+5]&&(s+=1),e+=t[s]}return e},t}(),s=function(){function t(){}return t}();s.scaleNames=["easy :)","easy :(","island :)","island :(","blues :)","blues :(","normal :)","normal :(","romani :)","romani :(","enigma","expert"],s.scaleFlags=[[!0,!1,!0,!1,!0,!1,!1,!0,!1,!0,!1,!1],[!0,!1,!1,!0,!1,!0,!1,!0,!1,!1,!0,!1],[!0,!1,!1,!1,!0,!0,!1,!0,!1,!1,!1,!0],[!0,!0,!1,!0,!1,!1,!1,!0,!0,!1,!1,!1],[!0,!1,!0,!0,!0,!1,!1,!0,!1,!0,!1,!1],[!0,!1,!1,!0,!1,!0,!0,!0,!1,!1,!0,!1],[!0,!1,!0,!1,!0,!0,!1,!0,!1,!0,!1,!0],[!0,!1,!0,!0,!1,!0,!1,!0,!0,!1,!0,!1],[!0,!0,!1,!1,!0,!0,!1,!0,!0,!1,!0,!1],[!0,!1,!0,!0,!1,!1,!0,!0,!0,!1,!1,!0],[!0,!1,!0,!1,!0,!1,!0,!1,!0,!1,!0,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0]],s.pianoScaleFlags=[!0,!1,!0,!1,!0,!0,!1,!0,!1,!0,!1,!0],s.blackKeyNameParents=[-1,1,-1,1,-1,1,-1,-1,1,-1,1,-1],s.noteNames=["C",null,"D",null,"E","F",null,"G",null,"A",null,"B"],s.keyNames=["B","A♯","A","G♯","G","F♯","F","E","D♯","D","C♯","C"],s.keyTransposes=[23,22,21,20,19,18,17,16,15,14,13,12],s.tempoNames=["molasses","slow","leisurely","moderate","steady","brisk","hasty","fast","strenuous","grueling","hyper","ludicrous"],s.reverbRange=4,s.beatsMin=3,s.beatsMax=15,s.barsMin=1,s.barsMax=128,s.patternsMin=1,s.patternsMax=64,s.instrumentsMin=1,s.instrumentsMax=10,s.partNames=["triples","standard"],s.partCounts=[3,4],s.waveNames=["triangle","square","pulse wide","pulse narrow","sawtooth","double saw","double pulse","spiky","plateau"],s.waveVolumes=[1,.5,.5,.5,.65,.5,.4,.4,.94],s.drumNames=["retro","white"],s.drumVolumes=[.25,1],s.filterNames=["sustain sharp","sustain medium","sustain soft","decay sharp","decay medium","decay soft"],s.filterBases=[2,3.5,5,1,2.5,4],s.filterDecays=[0,0,0,10,7,4],s.filterVolumes=[.4,.7,1,.5,.75,1],s.attackNames=["binary","sudden","smooth","slide"],s.effectNames=["none","vibrato light","vibrato delayed","vibrato heavy","tremelo light","tremelo heavy"],s.effectVibratos=[0,.15,.3,.45,0,0],s.effectTremelos=[0,0,0,0,.25,.5],s.chorusNames=["union","shimmer","hum","honky tonk","dissonant","fifths","octaves","bowed"],s.chorusValues=[0,.02,.05,.1,.25,3.5,6,.02],s.chorusOffsets=[0,0,0,0,0,3.5,6,0],s.chorusVolumes=[.7,.8,1,1,.9,.9,.8,1],s.volumeNames=["loudest","loud","medium","quiet","quietest","mute"],s.volumeValues=[0,.5,1,1.5,2,-1],s.channelVolumes=[.27,.27,.27,.19],s.drumInterval=6,s.numChannels=4,s.drumCount=12,s.noteCount=37,s.maxPitch=84,t.Music=s;var i=function(){function t(t,e,n){this.interval=t,this.time=e,this.volume=n}return t}();t.TonePin=i;var r=function(){function t(t,e,n,s,r){void 0===r&&(r=!1),this.notes=[t],this.pins=[new i(0,0,s),new i(0,n-e,r?0:s)],this.start=e,this.end=n}return t}();t.Tone=r;var h=function(){function t(){this.tones=[],this.instrument=0}return t.prototype.cloneTones=function(){for(var t=[],e=0,n=this.tones;e<n.length;e++){var s=n[e],h=new r(-1,s.start,s.end,3);h.notes=s.notes.concat(),h.pins=[];for(var o=0,a=s.pins;o<a.length;o++){var c=a[o];h.pins.push(new i(c.interval,c.time,c.volume))}t.push(h)}return t},t}();t.BarPattern=h;var o=function(){function t(t){void 0===t&&(t=null),null!=t?this.fromString(t):this.initToDefault()}return t.prototype.initToDefault=function(){this.channelPatterns=[[new h,new h,new h,new h,new h,new h,new h,new h],[new h,new h,new h,new h,new h,new h,new h,new h],[new h,new h,new h,new h,new h,new h,new h,new h],[new h,new h,new h,new h,new h,new h,new h,new h]],this.channelBars=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],this.channelOctaves=[3,2,1,0],this.instrumentVolumes=[[0],[0],[0],[0]],this.instrumentWaves=[[1],[1],[1],[1]],this.instrumentFilters=[[0],[0],[0],[0]],this.instrumentAttacks=[[1],[1],[1],[1]],this.instrumentEffects=[[0],[0],[0],[0]],this.instrumentChorus=[[0],[0],[0],[0]],this.scale=0,this.key=s.keyNames.length-1,this.loopStart=0,this.loopLength=4,this.tempo=7,this.reverb=0,this.beats=8,this.bars=16,this.patterns=8,this.parts=4,this.instruments=1},t.prototype.toString=function(){var e,i,r="",h=t.ba;for(r+=h[t.ca],r+="s"+h[this.scale],r+="k"+h[this.key],r+="l"+h[this.loopStart>>6]+h[63&this.loopStart],r+="e"+h[this.loopLength-1>>6]+h[this.loopLength-1&63],r+="t"+h[this.tempo],r+="m"+h[this.reverb],r+="a"+h[this.beats-1],r+="g"+h[this.bars-1>>6]+h[this.bars-1&63],r+="j"+h[this.patterns-1],r+="i"+h[this.instruments-1],r+="r"+h[s.partCounts.indexOf(this.parts)],r+="w",e=0;e<s.numChannels;e++)for(var o=0;o<this.instruments;o++)r+=h[this.instrumentWaves[e][o]];for(r+="f",e=0;e<s.numChannels;e++)for(var o=0;o<this.instruments;o++)r+=h[this.instrumentFilters[e][o]];for(r+="d",e=0;e<s.numChannels;e++)for(var o=0;o<this.instruments;o++)r+=h[this.instrumentAttacks[e][o]];for(r+="c",e=0;e<s.numChannels;e++)for(var o=0;o<this.instruments;o++)r+=h[this.instrumentEffects[e][o]];for(r+="h",e=0;e<s.numChannels;e++)for(var o=0;o<this.instruments;o++)r+=h[this.instrumentChorus[e][o]];for(r+="v",e=0;e<s.numChannels;e++)for(var o=0;o<this.instruments;o++)r+=h[this.instrumentVolumes[e][o]];for(r+="o",e=0;e<s.numChannels;e++)r+=h[this.channelOctaves[e]];r+="b",i=new n;for(var a=0;1<<a<this.patterns+1;)a++;for(e=0;e<s.numChannels;e++)for(var o=0;o<this.bars;o++)i.write(a,this.channelBars[e][o]);r+=i.encodeBase64(h),r+="p",i=new n;for(var c=0;1<<c<this.instruments;)c++;for(e=0;e<s.numChannels;e++){for(var l=3==e?0:12*this.channelOctaves[e],u=(3==e?4:12)+l,d=3==e?[4,6,7,2,3,8,0,10]:[12,19,24,31,36,7,0],b=[],o=0;o<d.length;o++)d[o]+=l;for(var p=0,f=this.channelPatterns[e];p<f.length;p++){var g=f[p];if(i.write(c,g.instrument),g.tones.length>0){i.write(1,1);for(var v=0,m=0,M=g.tones;m<M.length;m++){var y=M[m];y.start>v&&(i.write(2,0),i.writePartDuration(y.start-v));for(var w=new n,o=1;o<y.notes.length;o++)w.write(1,1);y.notes.length<4&&w.write(1,0),w.writePinCount(y.pins.length-1),w.write(2,y.pins[0].volume);for(var A=0,x=y.notes[0],C=x,E=[],o=1;o<y.pins.length;o++){var k=y.pins[o],j=x+k.interval;C!=j?(w.write(1,1),E.push(j),C=j):w.write(1,0),w.writePartDuration(k.time-A),A=k.time,w.write(2,k.volume)}var S=w.encodeBase64(h),P=b.indexOf(S);-1==P?(i.write(2,1),i.concat(w)):(i.write(1,1),i.writeLongTail(0,0,P),b.splice(P,1)),b.unshift(S),b.length>10&&b.pop();for(var T=y.notes.concat(E),o=0;o<T.length;o++){var L=T[o],B=d.indexOf(L);if(-1==B){var I=0,N=u;if(L>N)for(;N!=L;)N++,-1==d.indexOf(N)&&I++;else for(;N!=L;)N--,-1==d.indexOf(N)&&I--;i.write(1,0),i.writeNoteInterval(I)}else i.write(1,1),i.write(3,B),d.splice(B,1);d.unshift(L),d.length>8&&d.pop(),u=o==y.notes.length-1?y.notes[0]:L}v=y.end}v<this.beats*this.parts&&(i.write(2,0),i.writePartDuration(this.beats*this.parts-v))}else i.write(1,0)}}for(var R=i.encodeBase64(h),D=R.length,V="";D>0;)V=h[63&D]+V,D>>=6;return r+=h[V.length],r+=V,r+=R},t.prototype.fromString=function(n){if(n=n.trim(),"#"==n.charAt(0)&&(n=n.substring(1)),null==n||0==n.length)return void this.initToDefault();if("{"==n.charAt(0))return void this.fromJsonObject(JSON.parse(n));this.initToDefault();var o=0,a=t.da[n.charAt(o++)];if(!(-1==a||a>t.ca||a<t.ea)){var c=3>a,l=4>a,u=5>a,d=t.da;for(c&&(this.instrumentAttacks=[[0],[0],[0],[0]]),c&&(this.instrumentWaves=[[1],[1],[1],[0]]);o<n.length;){var b=n.charAt(o++),p=void 0;if("s"==b)this.scale=d[n.charAt(o++)],c&&10==this.scale&&(this.scale=11);else if("k"==b)this.key=d[n.charAt(o++)];else if("l"==b)u?this.loopStart=d[n.charAt(o++)]:this.loopStart=(d[n.charAt(o++)]<<6)+d[n.charAt(o++)];else if("e"==b)u?this.loopLength=d[n.charAt(o++)]:this.loopLength=(d[n.charAt(o++)]<<6)+d[n.charAt(o++)]+1;else if("t"==b)l?this.tempo=[1,4,7,10][d[n.charAt(o++)]]:this.tempo=d[n.charAt(o++)],this.tempo=this.fa(0,s.tempoNames.length,this.tempo);else if("m"==b)this.reverb=d[n.charAt(o++)],this.reverb=this.fa(0,s.reverbRange,this.reverb);else if("a"==b)c?this.beats=[6,7,8,9,10][d[n.charAt(o++)]]:this.beats=d[n.charAt(o++)]+1,this.beats=Math.max(s.beatsMin,Math.min(s.beatsMax,this.beats));else if("g"==b)this.bars=(d[n.charAt(o++)]<<6)+d[n.charAt(o++)]+1,this.bars=Math.max(s.barsMin,Math.min(s.barsMax,this.bars));else if("j"==b)this.patterns=d[n.charAt(o++)]+1,this.patterns=Math.max(s.patternsMin,Math.min(s.patternsMax,this.patterns));else if("i"==b)this.instruments=d[n.charAt(o++)]+1,this.instruments=Math.max(s.instrumentsMin,Math.min(s.instrumentsMax,this.instruments));else if("r"==b)this.parts=s.partCounts[d[n.charAt(o++)]];else if("w"==b)if(c)p=d[n.charAt(o++)],this.instrumentWaves[p][0]=this.fa(0,s.waveNames.length,d[n.charAt(o++)]);else for(p=0;p<s.numChannels;p++)for(var f=0;f<this.instruments;f++)this.instrumentWaves[p][f]=this.fa(0,s.waveNames.length,d[n.charAt(o++)]);else if("f"==b)if(c)p=d[n.charAt(o++)],this.instrumentFilters[p][0]=[0,2,3,5][this.fa(0,s.filterNames.length,d[n.charAt(o++)])];else for(p=0;p<s.numChannels;p++)for(var f=0;f<this.instruments;f++)this.instrumentFilters[p][f]=this.fa(0,s.filterNames.length,d[n.charAt(o++)]);else if("d"==b)if(c)p=d[n.charAt(o++)],this.instrumentAttacks[p][0]=this.fa(0,s.attackNames.length,d[n.charAt(o++)]);else for(p=0;p<s.numChannels;p++)for(var f=0;f<this.instruments;f++)this.instrumentAttacks[p][f]=this.fa(0,s.attackNames.length,d[n.charAt(o++)]);else if("c"==b)if(c)p=d[n.charAt(o++)],this.instrumentEffects[p][0]=this.fa(0,s.effectNames.length,d[n.charAt(o++)]),1==this.instrumentEffects[p][0]?this.instrumentEffects[p][0]=3:3==this.instrumentEffects[p][0]&&(this.instrumentEffects[p][0]=5);else for(p=0;p<s.numChannels;p++)for(var f=0;f<this.instruments;f++)this.instrumentEffects[p][f]=this.fa(0,s.effectNames.length,d[n.charAt(o++)]);else if("h"==b)if(c)p=d[n.charAt(o++)],this.instrumentChorus[p][0]=this.fa(0,s.chorusNames.length,d[n.charAt(o++)]);else for(p=0;p<s.numChannels;p++)for(var f=0;f<this.instruments;f++)this.instrumentChorus[p][f]=this.fa(0,s.chorusNames.length,d[n.charAt(o++)]);else if("v"==b)if(c)p=d[n.charAt(o++)],this.instrumentVolumes[p][0]=this.fa(0,s.volumeNames.length,d[n.charAt(o++)]);else for(p=0;p<s.numChannels;p++)for(var f=0;f<this.instruments;f++)this.instrumentVolumes[p][f]=this.fa(0,s.volumeNames.length,d[n.charAt(o++)]);else if("o"==b)if(c)p=d[n.charAt(o++)],this.channelOctaves[p]=this.fa(0,5,d[n.charAt(o++)]);else for(p=0;p<s.numChannels;p++)this.channelOctaves[p]=this.fa(0,5,d[n.charAt(o++)]);else if("b"==b){var g=void 0;if(c){p=d[n.charAt(o++)];var v=d[n.charAt(o++)];g=Math.ceil(.5*v);for(var m=new e(d,n.substr(o,g)),f=0;v>f;f++)this.channelBars[p][f]=m.read(3)+1}else if(u){for(var M=0;1<<M<this.patterns;)M++;g=Math.ceil(s.numChannels*this.bars*M/6);var m=new e(d,n.substr(o,g));for(p=0;p<s.numChannels;p++){this.channelBars[p].length=this.bars;for(var f=0;f<this.bars;f++)this.channelBars[p][f]=m.read(M)+1}}else{for(var y=0;1<<y<this.patterns+1;)y++;g=Math.ceil(s.numChannels*this.bars*y/6);var m=new e(d,n.substr(o,g));for(p=0;p<s.numChannels;p++){this.channelBars[p].length=this.bars;for(var f=0;f<this.bars;f++)this.channelBars[p][f]=m.read(y)}}o+=g}else if("p"==b){var w=0;if(c)p=d[n.charAt(o++)],o++,w=d[n.charAt(o++)],w<<=6,w+=d[n.charAt(o++)];else{p=0;for(var A=d[n.charAt(o++)];A>0;)w<<=6,w+=d[n.charAt(o++)],A--}var m=new e(d,n.substr(o,w));o+=w;for(var x=0;1<<x<this.instruments;)x++;for(;;){this.channelPatterns[p]=[];for(var C=3==p?0:12*this.channelOctaves[p],E=null,k=null,j=(3==p?4:12)+C,S=3==p?[4,6,7,2,3,8,0,10]:[12,19,24,31,36,7,0],P=[],f=0;f<S.length;f++)S[f]+=C;for(var f=0;f<this.patterns;f++){var T=new h;if(T.instrument=m.read(x),this.channelPatterns[p][f]=T,c||0!=m.read(1)){for(var L=0,B=[];L<this.beats*this.parts;){var I=1==m.read(1),N=!1,R=0;if(I?R=m.readLongTail(0,0):N=1==m.read(1),I||N){var D=void 0,V=void 0,Z=void 0;if(I)D=P[R],P.splice(R,1);else{for(D={},D.noteCount=1;D.noteCount<4&&1==m.read(1);)D.noteCount++;D.pinCount=m.readPinCount(),D.initialVolume=m.read(2),D.pins=[],D.length=0,D.bendCount=0;for(var G=0;G<D.pinCount;G++)V={},V.pitchBend=1==m.read(1),V.pitchBend&&D.bendCount++,D.length+=m.readPartDuration(),V.time=D.length,V.volume=m.read(2),D.pins.push(V)}P.unshift(D),P.length>10&&P.pop(),E=new r(0,L,L+D.length,D.initialVolume),E.notes=[],E.pins.length=1;for(var U=[],G=0;G<D.noteCount+D.bendCount;G++){var F=1==m.read(1);if(F){var Y=m.read(3);Z=S[Y],S.splice(Y,1)}else{var O=m.readNoteInterval();Z=j;for(var W=O;W>0;){for(Z++;-1!=S.indexOf(Z);)Z++;W--}for(;0>W;){for(Z--;-1!=S.indexOf(Z);)Z--;W++}}S.unshift(Z),S.length>8&&S.pop(),G<D.noteCount?E.notes.push(Z):U.push(Z),j=G==D.noteCount-1?E.notes[0]:Z}U.unshift(E.notes[0]);for(var z=0,J=D.pins;z<J.length;z++){var X=J[z];X.pitchBend&&U.shift(),k=new i(U[0]-E.notes[0],X.time,X.volume),E.pins.push(k)}L=E.end,B.push(E)}else{var _=m.readPartDuration();L+=_}}T.tones=B}}if(c)break;if(p++,p>=s.numChannels)break}}}}},t.prototype.toJsonObject=function(e,n,i){void 0===e&&(e=!0),void 0===n&&(n=1),void 0===i&&(i=!0);for(var r=[],h=0;h<s.numChannels;h++){for(var o=[],a=0;a<this.instruments;a++)3==h?o.push({volume:20*(5-this.instrumentVolumes[h][a]),wave:s.drumNames[this.instrumentWaves[h][a]],envelope:s.attackNames[this.instrumentAttacks[h][a]]}):o.push({volume:20*(5-this.instrumentVolumes[h][a]),wave:s.waveNames[this.instrumentWaves[h][a]],envelope:s.attackNames[this.instrumentAttacks[h][a]],filter:s.filterNames[this.instrumentFilters[h][a]],chorus:s.chorusNames[this.instrumentChorus[h][a]],effect:s.effectNames[this.instrumentEffects[h][a]]});for(var c=[],l=0,u=this.channelPatterns[h];l<u.length;l++){for(var d=u[l],b=[],p=0,f=d.tones;p<f.length;p++){for(var g=f[p],v=[],m=0,M=g.pins;m<M.length;m++){var y=M[m];v.push({tick:y.time+g.start,pitchBend:y.interval,volume:Math.round(100*y.volume/3)})}b.push({pitches:g.notes,points:v})}c.push({instrument:d.instrument+1,notes:b})}var w=[];if(e)for(var a=0;a<this.loopStart;a++)w.push(this.channelBars[h][a]);for(var A=0;n>A;A++)for(var a=this.loopStart;a<this.loopStart+this.loopLength;a++)w.push(this.channelBars[h][a]);if(i)for(var a=this.loopStart+this.loopLength;a<this.bars;a++)w.push(this.channelBars[h][a]);r.push({octaveScrollBar:this.channelOctaves[h],instruments:o,patterns:c,sequence:w})}return{version:t.ca,scale:s.scaleNames[this.scale],key:s.keyNames[this.key],introBars:this.loopStart,loopBars:this.loopLength,beatsPerBar:this.beats,ticksPerBeat:this.parts,beatsPerMinute:this.getBeatsPerMinute(),reverb:this.reverb,channels:r}},t.prototype.fromJsonObject=function(t){if(this.initToDefault(),t){var e=t.version;if(5===e){if(this.scale=11,void 0!=t.scale){var n=s.scaleNames.indexOf(t.scale);-1!=n&&(this.scale=n)}if(void 0!=t.key)if("number"==typeof t.key)this.key=s.keyNames.length-1-(t.key+1200>>>0)%s.keyNames.length;else if("string"==typeof t.key){var o=t.key,a=o.charAt(0).toUpperCase(),c=o.charAt(1).toLowerCase(),l={C:11,D:9,E:7,F:6,G:4,A:2,B:0},u={"#":-1,"♯":-1,b:1,"♭":1},d=l[a],b=u[c];void 0!=d&&(void 0!=b&&(d+=b),0>d&&(d+=12),d%=12,this.key=d)}if(void 0!=t.beatsPerMinute){var p=0|t.beatsPerMinute;this.tempo=Math.round(4+9*Math.log(p/120)/Math.LN2),this.tempo=this.fa(0,s.tempoNames.length,this.tempo)}void 0!=t.reverb&&(this.reverb=this.fa(0,s.reverbRange,0|t.reverb)),void 0!=t.beatsPerBar&&(this.beats=Math.max(s.beatsMin,Math.min(s.beatsMax,0|t.beatsPerBar))),void 0!=t.ticksPerBeat&&(this.parts=Math.max(3,Math.min(4,0|t.ticksPerBeat)));for(var f=1,g=1,v=1,m=0;m<s.numChannels;m++)if(t.channels&&t.channels[m]){var M=t.channels[m];M.instruments&&(f=Math.max(f,0|M.instruments.length)),M.patterns&&(g=Math.max(g,0|M.patterns.length)),M.sequence&&(v=Math.max(v,0|M.sequence.length))}this.instruments=f,this.patterns=g,this.bars=v,void 0!=t.introBars&&(this.loopStart=this.fa(0,this.bars,0|t.introBars)),void 0!=t.loopBars&&(this.loopLength=this.fa(1,this.bars-this.loopStart+1,0|t.loopBars));for(var m=0;m<s.numChannels;m++){var M=void 0;t.channels&&(M=t.channels[m]),void 0==M&&(M={}),void 0!=M.octaveScrollBar&&(this.channelOctaves[m]=this.fa(0,5,0|M.octaveScrollBar)),this.instrumentVolumes[m].length=this.instruments,this.instrumentWaves[m].length=this.instruments,this.instrumentAttacks[m].length=this.instruments,this.instrumentFilters[m].length=this.instruments,this.instrumentChorus[m].length=this.instruments,this.instrumentEffects[m].length=this.instruments,this.channelPatterns[m].length=this.patterns,this.channelBars[m].length=this.bars;for(var y=0;y<this.instruments;y++){var w=void 0;M.instruments&&(w=M.instruments[y]),void 0==w&&(w={}),void 0!=w.volume?this.instrumentVolumes[m][y]=this.fa(0,s.volumeNames.length,Math.round(5-(0|w.volume)/20)):this.instrumentVolumes[m][y]=0,this.instrumentAttacks[m][y]=s.attackNames.indexOf(w.envelope),-1==this.instrumentAttacks[m][y]&&(this.instrumentAttacks[m][y]=1),3==m?(this.instrumentWaves[m][y]=s.drumNames.indexOf(w.wave),-1==this.instrumentWaves[m][y]&&(this.instrumentWaves[m][y]=0),this.instrumentFilters[m][y]=0,this.instrumentChorus[m][y]=0,this.instrumentEffects[m][y]=0):(this.instrumentWaves[m][y]=s.waveNames.indexOf(w.wave),-1==this.instrumentWaves[m][y]&&(this.instrumentWaves[m][y]=1),this.instrumentFilters[m][y]=s.filterNames.indexOf(w.filter),-1==this.instrumentFilters[m][y]&&(this.instrumentFilters[m][y]=0),this.instrumentChorus[m][y]=s.chorusNames.indexOf(w.chorus),-1==this.instrumentChorus[m][y]&&(this.instrumentChorus[m][y]=0),this.instrumentEffects[m][y]=s.effectNames.indexOf(w.effect),-1==this.instrumentEffects[m][y]&&(this.instrumentEffects[m][y]=0))}for(var y=0;y<this.patterns;y++){var A=new h;this.channelPatterns[m][y]=A;var x=void 0;if(M.patterns&&(x=M.patterns[y]),void 0!=x&&(A.instrument=this.fa(0,this.instruments,(0|x.instrument)-1),x.notes&&x.notes.length>0))for(var C=Math.min(this.beats*this.parts,x.notes.length>>>0),E=0,k=0;k<x.notes.length&&!(k>=C);k++){var j=x.notes[k];if(j&&j.pitches&&j.pitches.length>=1&&j.points&&j.points.length>=2){var S=new r(0,0,0,0);S.notes=[],S.pins=[];for(var P=0;P<j.pitches.length;P++){var T=0|j.pitches[P];if(-1==S.notes.indexOf(T)&&(S.notes.push(T),S.notes.length>=4))break}if(!(S.notes.length<1)){for(var L=E,B=0,P=0;P<j.points.length;P++){var I=j.points[P];if(void 0!=I&&void 0!=I.tick){var N=void 0==I.pitchBend?0:0|I.pitchBend,R=0|I.tick,D=void 0==I.volume?3:Math.max(0,Math.min(3,Math.round(3*(0|I.volume)/100)));if(!(R>this.beats*this.parts)){if(0==S.pins.length){if(L>R)continue;S.start=R,B=N}else if(L>=R)continue;L=R,S.pins.push(new i(N-B,R-S.start,D))}}}if(!(S.pins.length<2)){S.end=S.pins[S.pins.length-1].time+S.start;for(var V=3==m?s.drumCount-1:s.maxPitch,Z=V,G=0,P=0;P<S.notes.length;P++)S.notes[P]+=B,(S.notes[P]<0||S.notes[P]>V)&&(S.notes.splice(P,1),P--),S.notes[P]<Z&&(Z=S.notes[P]),S.notes[P]>G&&(G=S.notes[P]);if(!(S.notes.length<1)){for(var P=0;P<S.pins.length;P++){var U=S.pins[P];U.interval+Z<0&&(U.interval=-Z),U.interval+G>V&&(U.interval=V-G),P>=2&&U.interval==S.pins[P-1].interval&&U.interval==S.pins[P-2].interval&&U.volume==S.pins[P-1].volume&&U.volume==S.pins[P-2].volume&&(S.pins.splice(P-1,1),P--)}A.tones.push(S),E=S.end}}}}}}for(var y=0;y<this.bars;y++)this.channelBars[m][y]=M.sequence?Math.min(this.patterns,M.sequence[y]>>>0):0}}}},t.prototype.fa=function(t,e,n){return e-=1,e>=n?n>=t?n:t:e},t.prototype.getPattern=function(t,e){var n=this.channelBars[t][e];return 0==n?null:this.channelPatterns[t][n-1]},t.prototype.getPatternInstrument=function(t,e){var n=this.getPattern(t,e);return null==n?0:n.instrument},t.prototype.getBeatsPerMinute=function(){return Math.round(120*Math.pow(2,(-4+this.tempo)/9))},t}();o.ea=2,o.ca=5,o.da={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,g:16,h:17,i:18,j:19,k:20,l:21,m:22,n:23,o:24,p:25,q:26,r:27,s:28,t:29,u:30,v:31,w:32,x:33,y:34,z:35,A:36,B:37,C:38,D:39,E:40,F:41,G:42,H:43,I:44,J:45,K:46,L:47,M:48,N:49,O:50,P:51,Q:52,R:53,S:54,T:55,U:56,V:57,W:58,X:59,Y:60,Z:61,"-":62,".":62,_:63},o.ba=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","-","_"],t.Song=o;var a=function(){function t(t){void 0===t&&(t=null),this.samplesPerSecond=44100,this.ga=.14,this.ha=2*Math.PI/(this.ga*this.samplesPerSecond),this.ia=2*Math.cos(this.ha),this.ja=1/(2*this.samplesPerSecond),this.ka=[new Float64Array([1/15,.2,5/15,7/15,.6,11/15,13/15,1,1,13/15,11/15,.6,7/15,5/15,.2,1/15,-1/15,-0.2,-5/15,-7/15,-0.6,-11/15,-13/15,-1,-1,-13/15,-11/15,-0.6,-7/15,-5/15,-0.2,-1/15]),new Float64Array([1,-1]),new Float64Array([1,-1,-1,-1]),new Float64Array([1,-1,-1,-1,-1,-1,-1,-1]),new Float64Array([1/31,3/31,5/31,7/31,9/31,11/31,13/31,15/31,17/31,19/31,21/31,23/31,25/31,27/31,29/31,1,-1,-29/31,-27/31,-25/31,-23/31,-21/31,-19/31,-17/31,-15/31,-13/31,-11/31,-9/31,-7/31,-5/31,-3/31,-1/31]),new Float64Array([0,-.2,-.4,-.6,-.8,-1,1,-.8,-.6,-.4,-.2,1,.8,.6,.4,.2]),new Float64Array([1,1,1,1,1,-1,-1,-1,1,1,1,1,-1,-1,-1,-1]),new Float64Array([1,-1,1,-1,1,0]),new Float64Array([0,.2,.4,.5,.6,.7,.8,.85,.9,.95,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,.95,.9,.85,.8,.7,.6,.5,.4,.2,0,-.2,-.4,-.5,-.6,-.7,-.8,-.85,-.9,-.95,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-.95,-.9,-.85,-.8,-.7,-.6,-.5,-.4,-.2])],this.la=[new Float32Array(32767),new Float32Array(32767)],this.song=null,this.stutterPressed=!1,this.pianoPressed=!1,this.pianoNote=0,this.pianoChannel=0,this.enableIntro=!0,this.enableOutro=!1,this.loopCount=-1,this.volume=1,this.ma=0,this.na=0,this.oa=0,this.pa=0,this.qa=0,this.ra=0,this.sa=!0,this.ta=0,this.ua=0,this.va=0,this.wa=0,this.xa=0,this.ya=0,this.za=0,this.Aa=0,this.Ba=0,this.Ca=0,this.Da=0,this.Ea=1,this.Fa=!1,this.Ga=0,this.Ha=0,this.Ia=new Float32Array(16384),this.Ja=0,this.Ka=0,this.La=0,this.Ma=0,this.Na=0;for(var e=0,n=this.ka;e<n.length;e++){for(var s=n[e],i=0,r=0;r<s.length;r++)i+=s[r];for(var h=i/s.length,r=0;r<s.length;r++)s[r]-=h}for(var o=0;o<this.la.length;o++){var s=this.la[o];if(0==o)for(var a=1,r=0;32767>r;r++){s[r]=2*(1&a)-1;var c=a>>1;1==(a+c&1)&&(c+=16384),a=c}else if(1==o)for(var r=0;32767>r;r++)s[r]=2*Math.random()-1}null!=t&&this.setSong(t)}return Object.defineProperty(t.prototype,"playing",{get:function(){return!this.sa},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playhead",{get:function(){return this.ma},set:function(t){if(null!=this.song){this.ma=Math.max(0,Math.min(this.song.bars,t));var e=this.ma;this.na=Math.floor(e),e=this.song.beats*(e-this.na),this.oa=Math.floor(e),e=this.song.parts*(e-this.oa),this.pa=Math.floor(e),e=4*(e-this.pa),this.qa=Math.floor(e);var n=this.Oa();e=n*(e-this.qa),this.ra=Math.floor(n-e),this.na<this.song.loopStart&&(this.enableIntro=!0),this.na>this.song.loopStart+this.song.loopLength&&(this.enableOutro=!0)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalSamples",{get:function(){if(null==this.song)return 0;var t=4*this.Oa()*this.song.parts*this.song.beats,e=this.loopCount;0>e&&(e=1);var n=this.song.loopLength*e;return this.enableIntro&&(n+=this.song.loopStart),this.enableOutro&&(n+=this.song.bars-(this.song.loopStart+this.song.loopLength)),n*t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalSeconds",{get:function(){return this.totalSamples/this.samplesPerSecond},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalBars",{get:function(){return null==this.song?0:this.song.bars},enumerable:!0,configurable:!0}),t.prototype.setSong=function(t){"string"==typeof t?this.song=new o(t):t instanceof o&&(this.song=t)},t.prototype.play=function(){if(this.sa){this.sa=!1;var t=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext;this.Pa=this.Pa||new t,this.Qa=this.Pa.createScriptProcessor?this.Pa.createScriptProcessor(2048,0,1):this.Pa.createJavaScriptNode(2048,0,1),this.Qa.onaudioprocess=this.Ra.bind(this),this.Qa.channelCountMode="explicit",this.Qa.channelInterpretation="speakers",this.Qa.connect(this.Pa.destination),this.samplesPerSecond=this.Pa.sampleRate,this.ha=2*Math.PI/(this.ga*this.samplesPerSecond),this.ia=2*Math.cos(this.ha),this.ja=1/(2*this.samplesPerSecond)}},t.prototype.pause=function(){this.sa||(this.sa=!0,this.Qa.disconnect(this.Pa.destination),this.Pa.close&&(this.Pa.close(),this.Pa=null),this.Qa=null)},t.prototype.snapToStart=function(){this.na=0,this.enableIntro=!0,this.snapToBar()},t.prototype.snapToBar=function(){this.ma=this.na,this.oa=0,this.pa=0,this.qa=0,this.ra=0,this.Ga=0,this.va=0,this.ya=0,this.Ba=0,this.Da=0,this.Ja=0,this.Ka=0,this.La=0,this.Ma=0,this.Na=0;for(var t=0;t<this.Ia.length;t++)this.Ia[t]=0},t.prototype.nextBar=function(){var t=this.na;this.na++,this.enableOutro?this.na>=this.song.bars&&(this.na=this.enableIntro?0:this.song.loopStart):(this.na>=this.song.loopStart+this.song.loopLength||this.na>=this.song.bars)&&(this.na=this.song.loopStart),this.ma+=this.na-t},t.prototype.prevBar=function(){var t=this.na;this.na--,this.na<0&&(this.na=this.song.loopStart+this.song.loopLength-1),this.na>=this.song.bars&&(this.na=this.song.bars-1),this.na<this.song.loopStart&&(this.enableIntro=!0),!this.enableOutro&&this.na>=this.song.loopStart+this.song.loopLength&&(this.na=this.song.loopStart+this.song.loopLength-1),this.ma+=this.na-t},t.prototype.Ra=function(t){var e=t.outputBuffer,n=e.getChannelData(0);this.synthesize(n,e.length)},t.prototype.synthesize=function(t,e){var n=this;if(null!=this.song){var i,r=0;if(this.stutterPressed){var h=this.na,o=this.oa,a=this.pa,c=this.qa,l=this.ra,u=this.ta,d=this.ua,b=this.va,p=this.wa,f=this.xa,g=this.ya,v=this.za,m=this.Aa,M=this.Ba,y=this.Ca,w=this.Da,A=this.Ea,x=this.Ga,C=this.Ha;i=function(){n.na=h,n.oa=o,n.pa=a,n.qa=c,n.ra=l,n.ta=u,n.ua=d,n.va=b,n.wa=p,n.xa=f,n.ya=g,n.za=v,n.Aa=m,n.Ba=M,n.Ca=y,n.Da=w,n.Ea=A,n.Ga=x,n.Ha=C}}var E=1/this.samplesPerSecond,k=this.Oa(),j=this.ia,S=this.ja,P=this.volume,T=this.Ia,L=.425*Math.pow(this.song.reverb/s.reverbRange,.667),B=!1;(0==this.ra||this.ra>k)&&(this.ra=k),this.pa>=this.song.parts&&(this.oa++,this.pa=0,this.qa=0,this.ra=k),this.oa>=this.song.beats&&(this.na++,this.oa=0,this.pa=0,this.qa=0,this.ra=k,-1==this.loopCount&&(this.na<this.song.loopStart&&!this.enableIntro&&(this.na=this.song.loopStart),this.na>=this.song.loopStart+this.song.loopLength&&!this.enableOutro&&(this.na=this.song.loopStart))),this.na>=this.song.bars&&(this.enableOutro?(this.na=0,this.enableIntro=!0,B=!0,this.pause()):this.na=this.song.loopStart),this.na>=this.song.loopStart&&(this.enableIntro=!1);var I,N,R,D,V,Z,G,U,F,Y,O,W,z,J,X,_,Q,q,H,K,$,tt,et,nt,st,it,rt,ht=function(){var t=n.song.getPatternInstrument(0,n.na),e=n.song.getPatternInstrument(1,n.na),i=n.song.getPatternInstrument(2,n.na),r=n.song.getPatternInstrument(3,n.na);I=s.channelVolumes[0]*(5==n.song.instrumentVolumes[0][t]?0:Math.pow(2,-s.volumeValues[n.song.instrumentVolumes[0][t]]))*s.waveVolumes[n.song.instrumentWaves[0][t]]*s.filterVolumes[n.song.instrumentFilters[0][t]]*s.chorusVolumes[n.song.instrumentChorus[0][t]]*.5,N=s.channelVolumes[1]*(5==n.song.instrumentVolumes[1][e]?0:Math.pow(2,-s.volumeValues[n.song.instrumentVolumes[1][e]]))*s.waveVolumes[n.song.instrumentWaves[1][e]]*s.filterVolumes[n.song.instrumentFilters[1][e]]*s.chorusVolumes[n.song.instrumentChorus[0][e]]*.5,R=s.channelVolumes[2]*(5==n.song.instrumentVolumes[2][i]?0:Math.pow(2,-s.volumeValues[n.song.instrumentVolumes[2][i]]))*s.waveVolumes[n.song.instrumentWaves[2][i]]*s.filterVolumes[n.song.instrumentFilters[2][i]]*s.chorusVolumes[n.song.instrumentChorus[0][i]]*.5,D=s.channelVolumes[3]*(5==n.song.instrumentVolumes[3][r]?0:Math.pow(2,-s.volumeValues[n.song.instrumentVolumes[3][r]]))*s.drumVolumes[n.song.instrumentWaves[3][r]],V=n.ka[n.song.instrumentWaves[0][t]],Z=n.ka[n.song.instrumentWaves[1][e]],G=n.ka[n.song.instrumentWaves[2][i]],U=n.la[n.song.instrumentWaves[3][r]],F=V.length,Y=Z.length,O=G.length,W=Math.pow(2,-s.filterBases[n.song.instrumentFilters[0][t]]),z=Math.pow(2,-s.filterBases[n.song.instrumentFilters[1][e]]),J=Math.pow(2,-s.filterBases[n.song.instrumentFilters[2][i]]),X=1,_=s.effectTremelos[n.song.instrumentEffects[0][t]],Q=s.effectTremelos[n.song.instrumentEffects[1][e]],q=s.effectTremelos[n.song.instrumentEffects[2][i]],H=Math.pow(2,(s.chorusOffsets[n.song.instrumentChorus[0][t]]+s.chorusValues[n.song.instrumentChorus[0][t]])/12),K=Math.pow(2,(s.chorusOffsets[n.song.instrumentChorus[1][e]]+s.chorusValues[n.song.instrumentChorus[1][e]])/12),$=Math.pow(2,(s.chorusOffsets[n.song.instrumentChorus[2][i]]+s.chorusValues[n.song.instrumentChorus[2][i]])/12),tt=Math.pow(2,(s.chorusOffsets[n.song.instrumentChorus[0][t]]-s.chorusValues[n.song.instrumentChorus[0][t]])/12),et=Math.pow(2,(s.chorusOffsets[n.song.instrumentChorus[1][e]]-s.chorusValues[n.song.instrumentChorus[1][e]])/12),nt=Math.pow(2,(s.chorusOffsets[n.song.instrumentChorus[2][i]]-s.chorusValues[n.song.instrumentChorus[2][i]])/12),st=7==n.song.instrumentChorus[0][t]?-1:1,it=7==n.song.instrumentChorus[1][e]?-1:1,rt=7==n.song.instrumentChorus[2][i]?-1:1,0==n.song.instrumentChorus[0][t]&&(n.ua=n.ta),0==n.song.instrumentChorus[1][e]&&(n.xa=n.wa),0==n.song.instrumentChorus[2][i]&&(n.Aa=n.za)};for(ht();e>0;){if(B){for(console.log("ended");e-- >0;)t[r]=0,r++;break}var ot=void 0;ot=this.ra<=e?this.ra:e,e-=ot,this.ra-=ot;for(var at,ct,lt,ut,dt,bt,pt,ft,gt,vt,mt,Mt,yt,wt,At,xt,Ct,Et,kt,jt,St,Pt,Tt,Lt,Bt,It=this.pa+this.oa*this.song.parts,Nt=0;4>Nt;Nt++){var Rt=this.song.getPattern(Nt,this.na),Dt=null==Rt?0:this.song.instrumentAttacks[Nt][Rt.instrument],Vt=null,Zt=null,Gt=null;if(null!=Rt)for(var Ut=0;Ut<Rt.tones.length;Ut++)if(Rt.tones[Ut].end<=It)Zt=Rt.tones[Ut];else if(Rt.tones[Ut].start<=It&&Rt.tones[Ut].end>It)Vt=Rt.tones[Ut];else if(Rt.tones[Ut].start>It){Gt=Rt.tones[Ut];break}null!=Vt&&null!=Zt&&Zt.end!=Vt.start&&(Zt=null),null!=Vt&&null!=Gt&&Gt.start!=Vt.end&&(Gt=null);var Ft=3==Nt?69:s.keyTransposes[this.song.key],Yt=3==Nt?s.drumInterval:1,Ot=void 0,Wt=void 0,zt=void 0,Jt=void 0,Xt=void 0,_t=void 0,Qt=void 0,qt=!1;if(this.pianoPressed&&Nt==this.pianoChannel){var Ht=this.Sa(Ft+this.pianoNote*Yt),Kt=void 0;3==Nt?this.song.instrumentWaves[3][Rt.instrument]>0?(X=Math.min(1,Ht*E*8),Kt=24):Kt=60:Kt=48,Ot=Ht*E,Wt=1,zt=Math.pow(2,-this.pianoNote*Yt/Kt),Jt=0,Xt=1,_t=1,Qt=Math.pow(2,s.effectVibratos[this.song.instrumentEffects[Nt][Rt.instrument]]/12)-1}else if(null==Vt)Ot=0,Wt=0,zt=0,Jt=0,Xt=1,_t=1,Qt=0,qt=!0;else{var $t=void 0;$t=2==Vt.notes.length?Vt.notes[this.qa>>1]:3==Vt.notes.length?Vt.notes[3==this.qa?1:this.qa]:4==Vt.notes.length?Vt.notes[this.qa]:Vt.notes[0];
for(var te=null,ee=null,ne=0,se=Vt.pins;ne<se.length;ne++){var ie=se[ne];if(!(ie.time+Vt.start<=It)){ee=ie;break}te=ie}var re=4*Vt.start,he=4*Vt.end,oe=4*(Vt.start+te.time),ae=4*(Vt.start+ee.time),ce=4*It+this.qa,le=4*It+this.qa+1,ue=(ce-oe)/(ae-oe),de=(le-oe)/(ae-oe),be=te.volume*(1-ue)+ee.volume*ue,pe=te.volume*(1-de)+ee.volume*de,fe=te.interval*(1-ue)+ee.interval*ue,ge=te.interval*(1-de)+ee.interval*de,ve=te.time*(1-ue)+ee.time*ue,me=te.time*(1-de)+ee.time*de,Me=!1;ce==re&&(0==Dt?Me=!0:2==Dt?be=0:3==Dt&&(null==Zt||Zt.notes.length>1||Vt.notes.length>1?be=0:0==Zt.pins[Zt.pins.length-1].volume||0==Vt.pins[0].volume?be=0:(fe=.5*(Zt.notes[0]+Zt.pins[Zt.pins.length-1].interval-$t),ve=.5*Zt.pins[Zt.pins.length-1].time,Me=!0))),le==he&&(1==Dt||2==Dt?pe=0:3==Dt&&(null==Gt||Gt.notes.length>1||Vt.notes.length>1?pe=0:0==Vt.pins[Vt.pins.length-1].volume||0==Gt.pins[0].volume?be=0:(ge=.5*(Gt.notes[0]+Vt.pins[Vt.pins.length-1].interval-$t),me*=.5)));var ye=1-(this.ra+ot)/k,we=1-this.ra/k,Ae=fe*(1-ye)+ge*ye,xe=fe*(1-we)+ge*we,Ce=ve*(1-ye)+me*ye,Ee=ve*(1-we)+me*we,ke=this.Sa(Ft+($t+Ae)*Yt),je=this.Sa(Ft+($t+xe)*Yt),Se=void 0;3==Nt?this.song.instrumentWaves[3][Rt.instrument]>0?(X=Math.min(1,ke*E*8),Se=24):Se=60:Se=48;var Pe=Math.pow(2,-($t+Ae)*Yt/Se),Te=Math.pow(2,-($t+xe)*Yt/Se);Pe*=this.Ta(be*(1-ye)+pe*ye),Te*=this.Ta(be*(1-we)+pe*we);var Le=je/ke;Ot=ke*E,Wt=Math.pow(Le,1/ot),zt=Pe,Jt=(Te-Pe)/ot;var Be=(ce+ye-re)*k/this.samplesPerSecond;0!=Be||Me||(qt=!0);var Ie=s.filterDecays[this.song.instrumentFilters[Nt][Rt.instrument]];Xt=Math.pow(2,-Ie*Ce*4*k/this.samplesPerSecond);var Ne=Math.pow(2,-Ie*Ee*4*k/this.samplesPerSecond);_t=Math.pow(Ne/Xt,1/ot),Qt=2==this.song.instrumentEffects[Nt][Rt.instrument]&&It-Vt.start<3?0:Math.pow(2,s.effectVibratos[this.song.instrumentEffects[Nt][Rt.instrument]]/12)-1}0==Nt?(at=Ot,ct=Wt,lt=zt*I,ut=Jt*I,dt=Xt*W,bt=_t,pt=Qt,qt&&(this.va=0,this.ta=0,this.ua=0)):1==Nt?(ft=Ot,gt=Wt,vt=zt*N,mt=Jt*N,Mt=Xt*z,yt=_t,wt=Qt,qt&&(this.ya=0,this.wa=0,this.xa=0)):2==Nt?(At=Ot,xt=Wt,Ct=zt*R,Et=Jt*R,kt=Xt*J,jt=_t,St=Qt,qt&&(this.Ba=0,this.za=0,this.Aa=0)):3==Nt&&(Pt=Ot/32767,Tt=Wt,Lt=zt*D,Bt=Jt*D)}for(var Re=Math.sin(this.Ga),De=Math.sin(this.Ga-this.ha),Ve=+this.va,Ze=+this.ta,Ge=+this.ua,Ue=+this.ya,Fe=+this.wa,Ye=+this.xa,Oe=+this.Ba,We=+this.za,ze=+this.Aa,Je=+this.Da,Xe=+this.Ca,_e=0|this.Ja,Qe=+this.Ka,qe=+this.La,He=+this.Ma,Ke=+this.Na,$e=+this.Ha;ot;){var tn=1+pt*Re,en=1+wt*Re,nn=1+St*Re,sn=1+_*(Re-1),rn=1+Q*(Re-1),hn=1+q*(Re-1),on=Re;Re=j*Re-De,De=on,Ve+=((V[0|Ze*F]+V[0|Ge*F]*st)*lt*sn-Ve)*dt,Ue+=((Z[0|Fe*Y]+Z[0|Ye*Y]*it)*vt*rn-Ue)*Mt,Oe+=((G[0|We*O]+G[0|ze*O]*rt)*Ct*hn-Oe)*kt,Je+=(U[0|32767*Xe]*Lt-Je)*X,lt+=ut,vt+=mt,Ct+=Et,Lt+=Bt,Ze+=at*tn*H,Ge+=at*tn*tt,Fe+=ft*en*K,Ye+=ft*en*et,We+=At*nn*$,ze+=At*nn*nt,Xe+=Pt,at*=ct,ft*=gt,At*=xt,Pt*=Tt,dt*=bt,Mt*=yt,kt*=jt,Ze-=0|Ze,Ge-=0|Ge,Fe-=0|Fe,Ye-=0|Ye,We-=0|We,ze-=0|ze,Xe-=0|Xe;var an=Ve+Ue+Oe,cn=T[_e]+an,ln=T[_e+3041&16383],un=T[_e+6426&16383],dn=T[_e+10907&16383],bn=-cn+ln,pn=-cn-ln,fn=-un+dn,gn=-un-dn;Qe+=.5*((bn+fn)*L-Qe),qe+=.5*((pn+gn)*L-qe),He+=.5*((bn-fn)*L-He),Ke+=.5*((pn-gn)*L-Ke),T[_e+3041&16383]=Qe,T[_e+6426&16383]=qe,T[_e+10907&16383]=He,T[_e]=Ke,_e=_e+1&16383;var vn=cn+ln+un+dn+Je,mn=0>vn?-vn:vn;$e-=S,mn>$e&&($e=mn),vn/=.75*$e+.25,vn*=P,t[r]=vn,r+=1,ot--}this.va=Ve,this.ta=Ze,this.ua=Ge,this.ya=Ue,this.wa=Fe,this.xa=Ye,this.Ba=Oe,this.za=We,this.Aa=ze,this.Da=Je,this.Ca=Xe,this.Ja=_e,this.Ka=Qe,this.La=qe,this.Ma=He,this.Na=Ke,this.Ha=$e,j*Re-De>De?this.Ga=Math.asin(Re):this.Ga=Math.PI-Math.asin(Re),0==this.ra&&(this.qa++,this.ra=k,4==this.qa&&(this.qa=0,this.pa++,this.pa==this.song.parts&&(this.pa=0,this.oa++,this.oa==this.song.beats&&(this.oa=0,this.Ga=0,this.na++,this.na<this.song.loopStart?this.enableIntro||(this.na=this.song.loopStart):this.enableIntro=!1,this.na>=this.song.loopStart+this.song.loopLength&&(this.loopCount>0&&this.loopCount--,(this.loopCount>0||!this.enableOutro)&&(this.na=this.song.loopStart)),this.na>=this.song.bars&&(this.na=0,this.enableIntro=!0,B=!0,this.pause()),ht()))))}this.stutterPressed&&i(),this.ma=(((this.qa+1-this.ra/k)/4+this.pa)/this.song.parts+this.oa)/this.song.beats+this.na}else for(var Ut=0;e>Ut;Ut++)t[Ut]=0},t.prototype.Sa=function(t){return 440*Math.pow(2,(t-69)/12)},t.prototype.Ta=function(t){return Math.pow(t/3,1.5)},t.prototype.Oa=function(){if(null==this.song)return 0;var t=this.song.getBeatsPerMinute(),e=t/60,n=e*this.song.parts,s=4*n;return Math.floor(this.samplesPerSecond/s)},t}();t.Synth=a}(beepbox||(beepbox={}));var beepbox;!function(t){function e(t,e,n){return t+n*(e-t)}function n(t,e,n){var s=document.createElementNS(i,t);if(e)for(var r=0,h=Object.keys(e);r<h.length;r++){var o=h[r];s.setAttribute(o,e[o])}if(n)for(var a=0,c=n;a<c.length;a++){var l=c[a];s.appendChild(l)}return s}t.lerp=e;var s;!function(t){function e(t,e,n){var s=document.createElement(t);if(e)for(var i=0,r=Object.keys(e);i<r.length;i++){var h=r[i];"style"==h?s.setAttribute(h,e[h]):s[h]=e[h]}if(n)for(var o=0,a=n;o<a.length;o++){var c=a[o];s.appendChild(c)}return s}function n(t,n){return e("button",t,n)}function s(t,n){return e("div",t,n)}function i(t,n){return e("span",t,n)}function r(t,n){return e("select",t,n)}function h(t,e,n,s){void 0===n&&(n=!1),void 0===s&&(s=!1);var i=document.createElement("option");return i.value=t,i.selected=n,i.disabled=s,i.appendChild(l(e)),i}function o(t){return e("canvas",t)}function a(t){return e("input",t)}function c(){return e("br")}function l(t){return document.createTextNode(t)}t.element=e,t.button=n,t.div=s,t.span=i,t.select=r,t.option=h,t.canvas=o,t.input=a,t.br=c,t.text=l}(s=t.html||(t.html={}));var i="http://www.w3.org/2000/svg";t.svgElement=n;var r=function(){function t(){this.Ua=[],this.Va=!1}return t.prototype.watch=function(t){-1==this.Ua.indexOf(t)&&this.Ua.push(t)},t.prototype.unwatch=function(t){var e=this.Ua.indexOf(t);-1!=e&&this.Ua.splice(e,1)},t.prototype.changed=function(){this.Va||(this.Va=!0,t.Wa.push(this))},t.prototype.Xa=function(){this.Va=!1;for(var t=0,e=this.Ua.concat();t<e.length;t++){var n=e[t];n()}},t.updateAll=function(){for(var t=0,e=this.Wa.concat();t<e.length;t++){var n=e[t];n.Xa()}this.Wa.length=0},t}();r.Wa=[],t.Model=r;var h=function(){function t(t){this.Ya=t,this.Za=!t,this.$a=!0}return t.prototype._a=function(){this.$a=!1},t.prototype.isNoop=function(){return this.$a},t.prototype.undo=function(){this.Ya?(this.ab(),this.Za=!0):(this.bb(),this.Za=!1)},t.prototype.redo=function(){this.Ya?(this.bb(),this.Za=!1):(this.ab(),this.Za=!0)},t.prototype.cb=function(){return this.Za},t.prototype.ab=function(){throw new Error("Change.doForwards(): Override me.")},t.prototype.bb=function(){throw new Error("Change.doBackwards(): Override me.")},t}();t.Change=h;var o=function(t){function e(){var e=t.call(this)||this;return e.db=[],e.eb=0,e.fb=null,e.changed(),e}return __extends(e,t),e.prototype.canUndo=function(){return this.eb>0},e.prototype.canRedo=function(){return this.eb<this.db.length},e.prototype.record=function(t){t.isNoop()||(this.db[this.eb]=t,this.eb++,this.db.length=this.eb,this.fb=t,this.changed())},e.prototype.undo=function(){if(!(this.eb<=0)){this.eb--;var t=this.db[this.eb];t.undo(),this.fb=null,this.changed()}},e.prototype.redo=function(){if(!(this.eb>=this.db.length)){var t=this.db[this.eb];t.redo(),this.eb++,this.changed()}},e.prototype.getRecentChange=function(){return this.fb},e}(r);t.ChangeHistory=o;var a=function(e){function n(){var n=e.call(this)||this;return n.channel=0,n.bar=0,n.barScrollPos=0,n.volume=75,n.history=new o,n.song=new t.Song,n.synth=new t.Synth(n.song),n.showFifth="true"==n.gb("showFifth"),n.showLetters="true"==n.gb("showLetters"),n.showChannels="true"==n.gb("showChannels"),n.showScrollBar="true"==n.gb("showScrollBar"),""!=n.gb("volume")&&(n.volume=Number(n.gb("volume"))),n.synth.volume=n.hb(),n}return __extends(n,e),n.prototype.savePreferences=function(){this.ib("showFifth",this.showFifth?"true":"false"),this.ib("showLetters",this.showLetters?"true":"false"),this.ib("showChannels",this.showChannels?"true":"false"),this.ib("showScrollBar",this.showScrollBar?"true":"false"),this.ib("volume",String(this.volume))},n.prototype.hb=function(){return Math.min(1,Math.pow(this.volume/50,.5))*Math.pow(2,(this.volume-75)/25)},n.prototype.setVolume=function(t){this.volume=t,this.savePreferences(),this.synth.volume=this.hb()},n.prototype.getCurrentPattern=function(){return this.song.getPattern(this.channel,this.bar)},n.prototype.getCurrentInstrument=function(){var t=this.getCurrentPattern();return null==t?0:t.instrument},n.prototype.ib=function(t,e){localStorage.setItem(t,e)},n.prototype.gb=function(t){var e=localStorage.getItem(t);if(null!=e)return e;for(var n=t+"=",s=document.cookie.split(";"),i=0;i<s.length;i++){for(var r=s[i];" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(n)){var h=r.substring(n.length,r.length);return this.ib(t,h),document.cookie=t+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;",h}}return""},n}(r);a.ca=2,t.SongDocument=a;var c=function(t){function e(e){void 0===e&&(e=null);var n=t.call(this,!1)||this;return null==e?n.db=[]:n.db=e.concat(),n}return __extends(e,t),e.prototype.append=function(t){t.isNoop()||(this.db[this.db.length]=t,this._a())},e.prototype.ab=function(){for(var t=0;t<this.db.length;t++)this.db[t].redo()},e.prototype.bb=function(){for(var t=this.db.length-1;t>=0;t--)this.db[t].undo()},e}(h);t.ChangeSequence=c;var l=function(t){function e(e,n){var s=t.call(this,!1)||this;return s.jb=e,s.kb=n,s.lb=s.kb.start,s.mb=s.kb.end,s.nb=s.kb.start,s.ob=s.kb.end,s.pb=s.kb.pins,s.qb=[],s.rb=s.kb.notes,s.sb=[],s}return __extends(e,t),e.prototype.tb=function(){for(var t=0;t<this.qb.length-1;)this.qb[t].time>=this.qb[t+1].time?this.qb.splice(t,1):t++;for(var t=1;t<this.qb.length-1;)this.qb[t-1].interval==this.qb[t].interval&&this.qb[t].interval==this.qb[t+1].interval&&this.qb[t-1].volume==this.qb[t].volume&&this.qb[t].volume==this.qb[t+1].volume?this.qb.splice(t,1):t++;for(var e=this.qb[0].interval,n=this.qb[0].time,t=0;t<this.rb.length;t++)this.sb[t]=this.rb[t]+e;for(var t=0;t<this.qb.length;t++)this.qb[t].interval-=e,this.qb[t].time-=n;this.nb=this.lb+n,this.ob=this.nb+this.qb[this.qb.length-1].time,this.ab(),this._a()},e.prototype.ab=function(){this.kb.pins=this.qb,this.kb.notes=this.sb,this.kb.start=this.nb,this.kb.end=this.ob,this.jb.changed()},e.prototype.bb=function(){this.kb.pins=this.pb,this.kb.notes=this.rb,this.kb.start=this.lb,this.kb.end=this.mb,this.jb.changed()},e}(h);t.ChangePins=l;var u=function(t){function e(e,n){var s=t.call(this,!1)||this;return s.jb=e,s.ub=e.song.instrumentAttacks[e.channel][e.getCurrentInstrument()],s.vb=n,s.ub!=s.vb&&(s._a(),s.redo()),s}return __extends(e,t),e.prototype.ab=function(){this.jb.song.instrumentAttacks[this.jb.channel][this.jb.getCurrentInstrument()]=this.vb,this.jb.changed()},e.prototype.bb=function(){this.jb.song.instrumentAttacks[this.jb.channel][this.jb.getCurrentInstrument()]=this.ub,this.jb.changed()},e}(h);t.ChangeAttack=u;var d=function(t){function e(e,n){var s=t.call(this,!1)||this;return s.jb=e,s.wb=e.song.channelBars[e.channel][e.bar],s.xb=n,s.wb!=s.xb&&n<=e.song.channelPatterns[e.channel].length&&(s._a(),s.redo()),s}return __extends(e,t),e.prototype.ab=function(){this.jb.song.channelBars[this.jb.channel][this.jb.bar]=this.xb,this.jb.changed()},e.prototype.bb=function(){this.jb.song.channelBars[this.jb.channel][this.jb.bar]=this.wb,this.jb.changed()},e}(h);t.ChangeBarPattern=d;var b=function(e){function n(n,s){var i=e.call(this,!1)||this;if(i.jb=n,i.yb=n.song.bars,i.zb=s,i.yb!=i.zb){i.Ab=n.song.channelBars,i.Bb=[];for(var r=0;r<t.Music.numChannels;r++){for(var h=[],o=0;o<i.zb;o++)h.push(o<i.yb?i.Ab[r][o]:1);i.Bb.push(h)}i.Cb=n.bar,i.Db=n.barScrollPos,i.Eb=n.song.loopStart,i.Fb=n.song.loopLength,i.Gb=n.bar,i.Hb=n.barScrollPos,i.Ib=n.song.loopStart,i.Jb=n.song.loopLength,i.yb>i.zb&&(i.Gb=Math.min(i.Gb,i.zb-1),i.Hb=Math.max(0,Math.min(i.zb-16,i.Hb)),i.Jb=Math.min(i.zb,i.Jb),i.Ib=Math.min(i.zb-i.Jb,i.Ib)),i.ab(),i._a()}return i}return __extends(n,e),n.prototype.ab=function(){this.jb.bar=this.Gb,this.jb.barScrollPos=this.Hb,this.jb.song.loopStart=this.Ib,this.jb.song.loopLength=this.Jb,this.jb.song.bars=this.zb,this.jb.song.channelBars=this.Bb,this.jb.changed()},n.prototype.bb=function(){this.jb.bar=this.Cb,this.jb.barScrollPos=this.Db,this.jb.song.loopStart=this.Eb,this.jb.song.loopLength=this.Fb,this.jb.song.bars=this.yb,this.jb.song.channelBars=this.Ab,this.jb.changed()},n}(h);t.ChangeBars=b;var p=function(e){function n(n,s){var i=e.call(this,!1)||this;if(i.jb=n,i.Kb=n.song.beats,i.Lb=s,i.Kb!=i.Lb){if(i.Kb>i.Lb){i.Mb=new c;for(var r=0;r<t.Music.numChannels;r++)for(var h=0;h<n.song.channelPatterns[r].length;h++)i.Mb.append(new Z(n,n.song.channelPatterns[r][h],i.Lb*n.song.parts,i.Kb*n.song.parts))}i.jb.song.beats=i.Lb,i.jb.changed(),i._a()}return i}return __extends(n,e),n.prototype.ab=function(){null!=this.Mb&&this.Mb.redo(),this.jb.song.beats=this.Lb,this.jb.changed()},n.prototype.bb=function(){this.jb.song.beats=this.Kb,null!=this.Mb&&this.Mb.undo(),this.jb.changed()},n}(h);t.ChangeBeats=p;var f=function(t){function e(e,n,s){var i=t.call(this,!1)||this;return i.jb=e,i.Nb=e.channel,i.Ob=n,i.Cb=e.bar,i.Gb=s,i.ab(),i.Nb==i.Ob&&i.Cb==i.Gb||i._a(),i}return __extends(e,t),e.prototype.ab=function(){this.jb.channel=this.Ob,this.jb.bar=this.Gb,this.jb.barScrollPos=Math.min(this.jb.bar,Math.max(this.jb.bar-15,this.jb.barScrollPos)),this.jb.changed()},e.prototype.bb=function(){this.jb.channel=this.Nb,this.jb.bar=this.Cb,this.jb.barScrollPos=Math.min(this.jb.bar,Math.max(this.jb.bar-15,this.jb.barScrollPos)),this.jb.changed()},e}(h);t.ChangeChannelBar=f;var g=function(t){function e(e,n){var s=t.call(this,!1)||this;return s.jb=e,s.Pb=e.song.instrumentChorus[e.channel][e.getCurrentInstrument()],s.Qb=n,s.Pb!=s.Qb&&(s._a(),s.redo()),s}return __extends(e,t),e.prototype.ab=function(){this.jb.song.instrumentChorus[this.jb.channel][this.jb.getCurrentInstrument()]=this.Qb,this.jb.changed()},e.prototype.bb=function(){this.jb.song.instrumentChorus[this.jb.channel][this.jb.getCurrentInstrument()]=this.Pb,this.jb.changed()},e}(h);t.ChangeChorus=g;var v=function(t){function e(e,n){var s=t.call(this,!1)||this;return s.jb=e,s.Rb=e.song.instrumentEffects[e.channel][e.getCurrentInstrument()],s.Sb=n,s.Rb!=s.Sb&&(s._a(),s.redo()),s}return __extends(e,t),e.prototype.ab=function(){this.jb.song.instrumentEffects[this.jb.channel][this.jb.getCurrentInstrument()]=this.Sb,this.jb.changed()},e.prototype.bb=function(){this.jb.song.instrumentEffects[this.jb.channel][this.jb.getCurrentInstrument()]=this.Rb,this.jb.changed()},e}(h);t.ChangeEffect=v;var m=function(t){function e(e,n){var s=t.call(this,!1)||this;return s.jb=e,s.Tb=e.song.instrumentFilters[e.channel][e.getCurrentInstrument()],s.Ub=n,s.Tb!=s.Ub&&(s._a(),s.redo()),s}return __extends(e,t),e.prototype.ab=function(){this.jb.song.instrumentFilters[this.jb.channel][this.jb.getCurrentInstrument()]=this.Ub,this.jb.changed()},e.prototype.bb=function(){this.jb.song.instrumentFilters[this.jb.channel][this.jb.getCurrentInstrument()]=this.Tb,this.jb.changed()},e}(h);t.ChangeFilter=m;var M=function(e){function n(n,s){var i=e.call(this,!1)||this;if(i.jb=n,i.Vb=n.song.instruments,i.Wb=s,i.Vb!=i.Wb){i.Xb=n.song.instrumentWaves,i.Yb=n.song.instrumentFilters,i.Zb=n.song.instrumentAttacks,i.$b=n.song.instrumentEffects,i._b=n.song.instrumentChorus,i.ac=n.song.instrumentVolumes,i.bc=[],i.cc=[],i.dc=[],i.ec=[],i.fc=[],i.gc=[];for(var r=[i.Xb,i.Yb,i.Zb,i.$b,i._b,i.ac],h=[i.bc,i.cc,i.dc,i.ec,i.fc,i.gc],o=0;o<h.length;o++)for(var a=r[o],c=h[o],l=0;l<t.Music.numChannels;l++){for(var u=[],d=0;d<i.Wb;d++)d<i.Vb?u.push(a[l][d]):0==o?u.push(1):2==o?u.push(1):u.push(0);c.push(u)}i.hc=[],i.ic=[];for(var l=0;l<t.Music.numChannels;l++){for(var b=[],p=[],d=0;d<n.song.patterns;d++){var f=n.song.channelPatterns[l][d].instrument;b.push(f),p.push(f<i.Wb?f:0)}i.hc.push(b),i.ic.push(p)}i.ab(),i._a()}return i}return __extends(n,e),n.prototype.ab=function(){this.jb.song.instruments=this.Wb,this.jb.song.instrumentWaves=this.bc,this.jb.song.instrumentFilters=this.cc,this.jb.song.instrumentAttacks=this.dc,this.jb.song.instrumentEffects=this.ec,this.jb.song.instrumentChorus=this.fc,this.jb.song.instrumentVolumes=this.gc,this.jc(this.ic),this.jb.changed()},n.prototype.bb=function(){this.jb.song.instruments=this.Vb,this.jb.song.instrumentWaves=this.Xb,this.jb.song.instrumentFilters=this.Yb,this.jb.song.instrumentAttacks=this.Zb,this.jb.song.instrumentEffects=this.$b,this.jb.song.instrumentChorus=this._b,this.jb.song.instrumentVolumes=this.ac,this.jc(this.hc),this.jb.changed()},n.prototype.jc=function(e){for(var n=0;n<t.Music.numChannels;n++)for(var s=0;s<this.jb.song.patterns;s++)this.jb.song.channelPatterns[n][s].instrument=e[n][s]},n}(h);t.ChangeInstruments=M;var y=function(t){function e(e,n){var s=t.call(this,!1)||this;return s.jb=e,s.kc=e.song.key,s.lc=n,s.kc!=s.lc&&(s._a(),s.redo()),s}return __extends(e,t),e.prototype.ab=function(){this.jb.song.key=this.lc,this.jb.changed()},e.prototype.bb=function(){this.jb.song.key=this.kc,this.jb.changed()},e}(h);t.ChangeKey=y;var w=function(t){function e(e,n,s){var i=t.call(this,!1)||this;return i.jb=e,i.lb=e.song.loopStart,i.nb=n,i.mc=e.song.loopLength,i.nc=s,i.lb==i.nb&&i.mc==i.nc||(i._a(),i.redo()),i}return __extends(e,t),e.prototype.ab=function(){this.jb.song.loopStart=this.nb,this.jb.song.loopLength=this.nc,this.jb.changed()},e.prototype.bb=function(){this.jb.song.loopStart=this.lb,this.jb.song.loopLength=this.mc,this.jb.changed()},e}(h);t.ChangeLoop=w;var A=function(t){function e(e,n,s,i,r,h){void 0===h&&(h=!1);var o=t.call(this,h)||this;return o.jb=e,o.oc=n,o.kb=s,o.pc=i,o.eb=r,o._a(),o.redo(),o}return __extends(e,t),e.prototype.ab=function(){this.kb.notes.splice(this.eb,0,this.pc),this.jb.changed()},e.prototype.bb=function(){this.kb.notes.splice(this.eb,1),this.jb.changed()},e}(h);t.ChangeNoteAdded=A;var x=function(t){function e(e,n){var s=t.call(this,!1)||this;return s.jb=e,s.qc=e.song.channelOctaves[e.channel],s.rc=n,s.qc!=s.rc&&(s._a(),s.redo()),s}return __extends(e,t),e.prototype.ab=function(){this.jb.song.channelOctaves[this.jb.channel]=this.rc,this.jb.changed()},e.prototype.bb=function(){this.jb.song.channelOctaves[this.jb.channel]=this.qc,this.jb.changed()},e}(h);t.ChangeOctave=x;var C=function(e){function n(n,s){var i=e.call(this,!1)||this;if(i.jb=n,i.sc=n.song.parts,i.tc=s,i.sc!=i.tc){i.Mb=new c;for(var r=0;r<t.Music.numChannels;r++)for(var h=0;h<n.song.channelPatterns[r].length;h++)i.Mb.append(new T(n,n.song.channelPatterns[r][h],i.sc,i.tc));n.song.parts=i.tc,n.changed(),i._a()}return i}return __extends(n,e),n.prototype.ab=function(){null!=this.Mb&&this.Mb.redo(),this.jb.song.parts=this.tc,this.jb.changed()},n.prototype.bb=function(){this.jb.song.parts=this.sc,null!=this.Mb&&this.Mb.undo(),this.jb.changed()},n}(h);t.ChangeParts=C;var E=function(t){function e(e,n){var s=t.call(this,!1)||this;s.jb=e;var i=e.getCurrentPattern();return s.oldTones=i.tones,i.tones=n,i.tones=i.cloneTones(),s.newTones=i.tones,e.changed(),s._a(),s}return __extends(e,t),e.prototype.ab=function(){var t=this.jb.getCurrentPattern();t.tones=this.newTones,this.jb.changed()},e.prototype.bb=function(){var t=this.jb.getCurrentPattern();t.tones=this.oldTones,this.jb.changed()},e}(h);t.ChangePaste=E;var k=function(t){function e(e,n){var s=t.call(this,!1)||this;return s.jb=e,s.uc=e.getCurrentPattern().instrument,s.vc=n,s.uc!=s.vc&&(s.ab(),s._a()),s}return __extends(e,t),e.prototype.ab=function(){this.jb.getCurrentPattern().instrument=this.vc,this.jb.changed()},e.prototype.bb=function(){this.jb.getCurrentPattern().instrument=this.uc,this.jb.changed()},e}(h);t.ChangePatternInstrument=k;var j=function(e){function n(n,s){var i=e.call(this,!1)||this;if(i.jb=n,i.wc=n.song.patterns,i.xc=s,i.wc!=i.xc){i.Ab=n.song.channelBars,i.Bb=[],i.yc=n.song.channelPatterns,i.zc=[];for(var r=0;r<t.Music.numChannels;r++){for(var h=[],o=0;o<n.song.channelBars[r].length;o++){var a=n.song.channelBars[r][o];a>i.xc&&(a=1),h.push(a)}i.Bb.push(h);for(var c=[],o=0;o<i.xc;o++)o<n.song.channelPatterns[r].length?c.push(n.song.channelPatterns[r][o]):c.push(new t.BarPattern);i.zc.push(c)}i.ab(),i._a()}return i}return __extends(n,e),n.prototype.ab=function(){null!=this.Mb&&this.Mb.redo(),this.jb.song.patterns=this.xc,this.jb.song.channelBars=this.Bb,this.jb.song.channelPatterns=this.zc,this.jb.changed()},n.prototype.bb=function(){this.jb.song.patterns=this.wc,this.jb.song.channelBars=this.Ab,this.jb.song.channelPatterns=this.yc,null!=this.Mb&&this.Mb.undo(),this.jb.changed()},n}(h);t.ChangePatterns=j;var S=function(e){function n(n,s,i,r){var h=e.call(this,n,s)||this;r-=h.lb;for(var o=h.pb[i].time,a=Math.min(o,r),c=Math.max(o,r),l=!1,u=0;u<h.pb.length;u++){var d=s.pins[u],b=d.time;a>b?h.qb.push(new t.TonePin(d.interval,b,d.volume)):b>c&&(l||(h.qb.push(new t.TonePin(h.pb[i].interval,r,h.pb[i].volume)),l=!0),h.qb.push(new t.TonePin(d.interval,b,d.volume)))}return l||h.qb.push(new t.TonePin(h.pb[i].interval,r,h.pb[i].volume)),h.tb(),h}return __extends(n,e),n}(l);t.ChangePinTime=S;var P=function(e){function n(n,s,i,r,h,o){var a=e.call(this,n,s)||this;i-=a.lb,r-=a.lb,h-=s.notes[o];var c,l,u,d,b=!1,p=!1,f=0,g=3,v=!0;for(r>i?(c=0,l=1,u=s.pins.length,d=function(t){a.qb.push(t)}):(c=s.pins.length-1,l=-1,u=-1,d=function(t){a.qb.unshift(t)});c!=u;c+=l)for(var m=s.pins[c],M=m.time;;)if(b){if(p){if(M*l==r*l)break;m.interval!=f&&(v=!1),d(new t.TonePin(v?h:m.interval,M,m.volume));break}if(r*l>=M*l&&(f=m.interval,g=m.volume),r*l>M*l)break;d(new t.TonePin(h,r,g)),p=!0}else{if(i*l>=M*l&&(f=m.interval,g=m.volume),i*l>M*l){d(new t.TonePin(m.interval,M,m.volume));break}d(new t.TonePin(f,i,g)),b=!0}return p||d(new t.TonePin(h,r,g)),a.tb(),a}return __extends(n,e),n}(l);t.ChangePitchBend=P;var T=function(t){function e(e,n,s,i){var r,h=t.call(this)||this;4==s&&3==i&&(r=function(t){return Math.ceil(3*t/4)}),3==s&&4==i&&(r=function(t){return Math.floor(4*t/3)});for(var o=0;o<n.tones.length;){var a=n.tones[o];r(a.start)>=r(a.end)?h.append(new D(e,n,a,o,!0)):(h.append(new L(e,a,r)),o++)}return h}return __extends(e,t),e}(c);t.ChangeRhythm=T;var L=function(e){function n(n,s,i){for(var r=e.call(this,n,s)||this,h=0,o=r.pb;h<o.length;h++){var a=o[h];r.qb.push(new t.TonePin(a.interval,i(a.time+r.lb)-r.lb,a.volume))}return r.tb(),r}return __extends(n,e),n}(l);t.ChangeRhythmTone=L;var B=function(t){function e(e,n){var s=t.call(this,!1)||this;return s.jb=e,s.Ac=e.song.scale,s.Bc=n,s.Ac!=s.Bc&&(s._a(),s.redo()),s}return __extends(e,t),e.prototype.ab=function(){this.jb.song.scale=this.Bc,this.jb.changed()},e.prototype.bb=function(){this.jb.song.scale=this.Ac,this.jb.changed()},e}(h);t.ChangeScale=B;var I=function(t){function e(e,n){var s=t.call(this,!1)||this;return s.jb=e,s.Cc=e.song,s.Cb=e.bar,e.song=n,e.synth.setSong(n),s.Dc=n,s.Gb=Math.max(0,Math.min(e.song.bars-1,s.Cb)),e.bar=s.Gb,e.barScrollPos=Math.max(0,Math.min(e.song.bars-16,e.barScrollPos)),e.barScrollPos=Math.min(e.bar,Math.max(e.bar-15,e.barScrollPos)),e.changed(),s._a(),s}return __extends(e,t),e.prototype.ab=function(){this.jb.song=this.Dc,this.jb.synth.setSong(this.jb.song),this.jb.bar=this.Gb,this.jb.barScrollPos=Math.max(0,Math.min(this.jb.song.bars-16,this.jb.barScrollPos)),this.jb.barScrollPos=Math.min(this.jb.bar,Math.max(this.jb.bar-15,this.jb.barScrollPos)),this.jb.changed()},e.prototype.bb=function(){this.jb.song=this.Cc,this.jb.synth.setSong(this.jb.song),this.jb.bar=this.Cb,this.jb.barScrollPos=Math.max(0,Math.min(this.jb.song.bars-16,this.jb.barScrollPos)),this.jb.barScrollPos=Math.min(this.jb.bar,Math.max(this.jb.bar-15,this.jb.barScrollPos)),this.jb.changed()},e}(h);t.ChangeSong=I;var N=function(t){function e(e,n){var s=t.call(this,!1)||this;return s.jb=e,s.Ec=e.song.tempo,s.Fc=n,s.Ec!=s.Fc&&(s._a(),s.redo()),s}return __extends(e,t),e.prototype.ab=function(){this.jb.song.tempo=this.Fc,this.jb.changed()},e.prototype.bb=function(){this.jb.song.tempo=this.Ec,this.jb.changed()},e}(h);t.ChangeTempo=N;var R=function(t){function e(e,n){var s=t.call(this,!1)||this;return s.jb=e,s.Gc=e.song.reverb,s.Hc=n,s.Gc!=s.Hc&&(s._a(),s.redo()),s}return __extends(e,t),e.prototype.ab=function(){this.jb.song.reverb=this.Hc,this.jb.changed()},e.prototype.bb=function(){this.jb.song.reverb=this.Gc,this.jb.changed()},e}(h);t.ChangeReverb=R;var D=function(t){function e(e,n,s,i,r){void 0===r&&(r=!1);var h=t.call(this,r)||this;return h.jb=e,h.na=n,h.kb=s,h.eb=i,h._a(),h.redo(),h}return __extends(e,t),e.prototype.ab=function(){this.na.tones.splice(this.eb,0,this.kb),this.jb.changed()},e.prototype.bb=function(){this.na.tones.splice(this.eb,1),this.jb.changed()},e}(h);t.ChangeToneAdded=D;var V=function(e){function n(n,s,i,r){var h=e.call(this,n,s)||this;i-=h.lb,r-=h.lb;var o,a=!1,c=h.pb[0].volume,l=h.pb[0].interval,u=!0;for(o=0;o<h.pb.length;o++){var d=h.pb[o];if(d.time<i)c=d.volume,l=d.interval;else{if(!(d.time<=r))break;if(d.time>i&&!a&&h.qb.push(new t.TonePin(l,i,c)),h.qb.push(new t.TonePin(d.interval,d.time,d.volume)),a=!0,d.time==r){u=!1;break}}}return u&&h.qb.push(new t.TonePin(h.pb[o].interval,r,h.pb[o].volume)),h.tb(),h}return __extends(n,e),n}(l);t.ChangeToneLength=V;var Z=function(t){function e(e,n,s,i,r){void 0===r&&(r=null);for(var h=t.call(this)||this,o=0;o<n.tones.length;){var a=n.tones[o];if(a==r&&null!=r)o++;else if(a.end<=s)o++;else{if(a.start>=i)break;a.start<s?(h.append(new V(e,a,a.start,s)),o++):a.end>i?(h.append(new V(e,a,i,a.end)),o++):h.append(new D(e,n,a,o,!0))}}return h}return __extends(e,t),e}(c);t.ChangeToneTruncate=Z;var G=function(e){function n(n,s,i){var r=e.call(this,!1)||this;r.jb=n,r.kb=s,r.pb=s.pins,r.qb=[],r.rb=s.notes,r.sb=[];for(var h=3==n.channel?t.Music.drumCount-1:t.Music.maxPitch,o=0;o<r.rb.length;o++){var a=r.rb[o];if(i){for(var c=a+1;h>=c;c++)if(3==n.channel||t.Music.scaleFlags[n.song.scale][c%12]){a=c;break}}else for(var c=a-1;c>=0;c--)if(3==n.channel||t.Music.scaleFlags[n.song.scale][c%12]){a=c;break}for(var l=!1,c=0;c<r.sb.length;c++)if(r.sb[c]==a){l=!0;break}l||r.sb.push(a)}for(var u=0,d=h,o=1;o<r.sb.length;o++){var b=r.sb[0]-r.sb[o];b>u&&(u=b),d>b+h&&(d=b+h)}for(var p=0,f=r.pb;p<f.length;p++){var g=f[p],v=g.interval+r.rb[0];if(u>v&&(v=u),v>d&&(v=d),i){for(var o=v+1;d>=o;o++)if(3==n.channel||t.Music.scaleFlags[n.song.scale][o%12]){v=o;break}}else for(var o=v-1;o>=u;o--)if(3==n.channel||t.Music.scaleFlags[n.song.scale][o%12]){v=o;break}v-=r.sb[0],r.qb.push(new t.TonePin(v,g.time,g.volume))}if(0!=r.qb[0].interval)throw new Error("wrong pin start interval");for(var o=1;o<r.qb.length-1;)r.qb[o-1].interval==r.qb[o].interval&&r.qb[o].interval==r.qb[o+1].interval&&r.qb[o-1].volume==r.qb[o].volume&&r.qb[o].volume==r.qb[o+1].volume?r.qb.splice(o,1):o++;return r.ab(),r._a(),r}return __extends(n,e),n.prototype.ab=function(){this.kb.pins=this.qb,this.kb.notes=this.sb,this.jb.changed()},n.prototype.bb=function(){this.kb.pins=this.pb,this.kb.notes=this.rb,this.jb.changed()},n}(h);t.ChangeTransposeTone=G;var U=function(t){function e(e,n,s){for(var i=t.call(this)||this,r=0;r<n.tones.length;r++)i.append(new G(e,n.tones[r],s));return i}return __extends(e,t),e}(c);t.ChangeTranspose=U;var F=function(t){function e(e,n){var s=t.call(this,!1)||this;return s.jb=e,s.Ic=e.song.instrumentVolumes[e.channel][e.getCurrentInstrument()],s.Jc=n,s.Ic!=s.Jc&&(s._a(),s.redo()),s}return __extends(e,t),e.prototype.ab=function(){this.jb.song.instrumentVolumes[this.jb.channel][this.jb.getCurrentInstrument()]=this.Jc,this.jb.changed()},e.prototype.bb=function(){this.jb.song.instrumentVolumes[this.jb.channel][this.jb.getCurrentInstrument()]=this.Ic,this.jb.changed()},e}(h);t.ChangeVolume=F;var Y=function(e){function n(n,s,i,r,h,o){var a=e.call(this,!1)||this;a.jb=n,a.na=s,a.kb=i,a.pb=i.pins,a.qb=[];for(var c=!1,l=0,u=i.pins;l<u.length;l++){var d=u[l];d.time<r?a.qb.push(d):d.time==r?(a.qb.push(new t.TonePin(o,r,h)),c=!0):(c||(a.qb.push(new t.TonePin(o,r,h)),c=!0),a.qb.push(d))}for(var b=1;b<a.qb.length-1;)a.qb[b-1].interval==a.qb[b].interval&&a.qb[b].interval==a.qb[b+1].interval&&a.qb[b-1].volume==a.qb[b].volume&&a.qb[b].volume==a.qb[b+1].volume?a.qb.splice(b,1):b++;return a.ab(),a._a(),a}return __extends(n,e),n.prototype.ab=function(){this.kb.pins=this.qb,this.jb.changed()},n.prototype.bb=function(){this.kb.pins=this.pb,this.jb.changed()},n}(h);t.ChangeVolumeBend=Y;var O=function(t){function e(e,n){var s=t.call(this,!1)||this;return s.jb=e,s.Kc=e.song.instrumentWaves[e.channel][e.getCurrentInstrument()],s.Lc=n,s.Kc!=s.Lc&&(s._a(),s.redo()),s}return __extends(e,t),e.prototype.ab=function(){this.jb.song.instrumentWaves[this.jb.channel][this.jb.getCurrentInstrument()]=this.Lc,this.jb.changed()},e.prototype.bb=function(){this.jb.song.instrumentWaves[this.jb.channel][this.jb.getCurrentInstrument()]=this.Kc,this.jb.changed()},e}(h);t.ChangeWave=O;var W=function(){function t(){this.valid=!1,this.prevTone=null,this.curTone=null,this.nextTone=null,this.note=0,this.noteIndex=-1,this.curIndex=0,this.start=0,this.end=0,this.part=0,this.tonePart=0,this.nearPinIndex=0,this.pins=null}return t}();t.PatternCursor=W}(beepbox||(beepbox={}));var beepbox;!function(t){function e(t){return t.toFixed(2).replace(/\.?0*$/,"")}function n(t){var e=t.cloneNode(!1);return t.parentNode.replaceChild(e,t),e}var s=function(){function s(s){var i=this;this.Mc=s,this.Nc=t.svgElement("pattern",{id:"patternEditorNoteBackground",x:"0",y:"0",width:"64",height:"156",patternUnits:"userSpaceOnUse"}),this.Oc=t.svgElement("pattern",{id:"patternEditorDrumBackground",x:"0",y:"0",width:"64",height:"40",patternUnits:"userSpaceOnUse"}),this.Pc=t.svgElement("rect",{x:"0",y:"0",width:"512",height:"481","pointer-events":"none",fill:"url(#patternEditorNoteBackground)"}),this.Qc=t.svgElement("svg"),this.Rc=t.svgElement("rect",{id:"",x:"0",y:"0",width:"4",height:"481",fill:"white","pointer-events":"none"}),this.Sc=t.svgElement("path",{fill:"none",stroke:"white","stroke-width":"2","pointer-events":"none"}),this.Tc=t.svgElement("svg",{style:"background-color: #000000; touch-action: none; position: absolute;",width:"512",height:"481"},[t.svgElement("defs",void 0,[this.Nc,this.Oc]),this.Pc,this.Qc,this.Sc,this.Rc]),this.container=t.html.div({style:"height: 481px; overflow:hidden; position: relative;"},[this.Tc]),this.Uc=13,this.Vc=40,this.Wc=[],this.Xc=t.svgElement("rect"),this.Yc=[[new t.TonePin(0,0,3),new t.TonePin(0,2,3)],[new t.TonePin(0,0,3),new t.TonePin(0,2,3)],[new t.TonePin(0,0,3),new t.TonePin(0,2,3)],[new t.TonePin(0,0,3),new t.TonePin(0,2,0)]],this.Zc=481,this.$c=0,this._c=0,this.ad=!1,this.bd=!1,this.cd=!1,this.dd=!1,this.ed=this.Yc.concat(),this.fd=0,this.gd=0,this.hd=0,this.jd=0,this.kd=null,this.ld=new t.PatternCursor,this.md=0,this.nd=0,this.od=-1,this.pd=-1,this.qd=!1,this.rd=!1,this.resetCopiedPins=function(){i.ed=i.Yc.concat()},this.sd=function(t){if(i.Mc.synth.playing&&null!=i.oc&&i.Mc.song.getPattern(i.Mc.channel,Math.floor(i.Mc.synth.playhead))==i.oc){i.Rc.setAttribute("visibility","visible");var n=i.Mc.synth.playhead-Math.floor(i.Mc.synth.playhead);Math.abs(n-i.md)>.1?i.md=n:i.md+=.2*(n-i.md),i.Rc.setAttribute("x",""+e(i.md*i.td-2))}else i.Rc.setAttribute("visibility","hidden");window.requestAnimationFrame(i.sd)},this.ud=function(t){i.bd||(i.bd=!0)},this.vd=function(t){i.bd&&(i.bd=!1)},this.wd=function(t){if(t.preventDefault(),null!=i.oc){var e=i.Tc.getBoundingClientRect();i.$c=(t.clientX||t.pageX)-e.left,i._c=(t.clientY||t.pageY)-e.top,i.ad=!0,i.fd=i.$c,i.gd=i._c,i.hd=i.$c,i.jd=i._c,i.xd(),i.yd()}},this.zd=function(t){if(t.preventDefault(),null!=i.oc){i.ad=!0;var e=i.Tc.getBoundingClientRect();i.$c=t.touches[0].clientX-e.left,i._c=t.touches[0].clientY-e.top,i.fd=i.$c,i.gd=i._c,i.hd=i.$c,i.jd=i._c,i.xd(),i.yd()}},this.Ad=function(t){var e=i.Tc.getBoundingClientRect();i.$c=(t.clientX||t.pageX)-e.left,i._c=(t.clientY||t.pageY)-e.top,i.Bd()},this.Cd=function(t){if(i.ad){t.preventDefault();var e=i.Tc.getBoundingClientRect();i.$c=t.touches[0].clientX-e.left,i._c=t.touches[0].clientY-e.top,i.Bd()}},this.Dd=function(e){
if(i.ld.valid&&null!=i.oc){if(i.cd)null!=i.kd&&(i.Mc.history.record(i.kd),i.kd=null);else if(i.ad)if(null==i.ld.curTone){var n=new t.Tone(i.ld.note,i.ld.start,i.ld.end,3,3==i.Mc.channel);n.pins=[];for(var s=0,r=i.ld.pins;s<r.length;s++){var h=r[s];n.pins.push(new t.TonePin(0,h.time,h.volume))}i.Mc.history.record(new t.ChangeToneAdded(i.Mc,i.oc,n,i.ld.curIndex))}else if(-1==i.ld.noteIndex){var o=new t.ChangeSequence;4==i.ld.curTone.notes.length&&o.append(new t.ChangeNoteAdded(i.Mc,i.oc,i.ld.curTone,i.ld.curTone.notes[0],0,!0)),o.append(new t.ChangeNoteAdded(i.Mc,i.oc,i.ld.curTone,i.ld.note,i.ld.curTone.notes.length)),i.Mc.history.record(o),i.Ed(i.ld.curTone)}else 1==i.ld.curTone.notes.length?i.Mc.history.record(new t.ChangeToneAdded(i.Mc,i.oc,i.ld.curTone,i.ld.curIndex,!0)):i.Mc.history.record(new t.ChangeNoteAdded(i.Mc,i.oc,i.ld.curTone,i.ld.note,i.ld.curTone.notes.indexOf(i.ld.note),!0));i.ad=!1,i.cd=!1,i.xd(),i.yd()}},this.Fd=function(){i.td=i.Mc.showLetters?i.Mc.showScrollBar?460:480:i.Mc.showScrollBar?492:512,i.oc=i.Mc.getCurrentPattern(),i.Gd=i.td/(i.Mc.song.beats*i.Mc.song.parts),i.Hd=3==i.Mc.channel?i.Vc:i.Uc,i.Id=3==i.Mc.channel?t.Music.drumCount:t.Music.noteCount,i.nd=12*i.Mc.song.channelOctaves[i.Mc.channel],i.Jd=i.ed[i.Mc.channel],i.od!=i.td&&(i.od=i.td,i.Tc.setAttribute("width",""+i.td),i.Pc.setAttribute("width",""+i.td));var e=i.td/i.Mc.song.beats;if(i.pd!=e){i.pd=e,i.Nc.setAttribute("width",""+e),i.Oc.setAttribute("width",""+e),i.Xc.setAttribute("width",""+(e-2));for(var s=0;12>s;s++)i.Wc[s].setAttribute("width",""+(e-2))}if(i.ad||i.xd(),i.Qc=n(i.Qc),i.yd(),null==i.oc)return void(i.Tc.style.visibility="hidden");i.Tc.style.visibility="visible",i.qd!=i.Mc.showFifth&&(i.qd=i.Mc.showFifth,i.Wc[7].setAttribute("fill",i.Mc.showFifth?"#446688":"#444444"));for(var s=0;12>s;s++)i.Wc[s].style.visibility=t.Music.scaleFlags[i.Mc.song.scale][s]?"visible":"hidden";if(3==i.Mc.channel?i.rd||(i.rd=!0,i.Pc.setAttribute("fill","url(#patternEditorDrumBackground)"),i.Pc.setAttribute("height",""+i.Vc*t.Music.drumCount),i.Tc.setAttribute("height",""+i.Vc*t.Music.drumCount)):i.rd&&(i.rd=!1,i.Pc.setAttribute("fill","url(#patternEditorNoteBackground)"),i.Pc.setAttribute("height",""+i.Zc),i.Tc.setAttribute("height",""+i.Zc)),3!=i.Mc.channel&&i.Mc.showChannels)for(var r=2;r>=0;r--)if(r!=i.Mc.channel){var h=i.Mc.song.getPattern(r,i.Mc.bar);if(null!=h)for(var o=0,a=h.tones;o<a.length;o++)for(var c=a[o],l=0,u=c.notes;l<u.length;l++){var d=u[l],b=t.svgElement("path");b.setAttribute("fill",t.SongEditor.noteColorsDim[r]),b.setAttribute("pointer-events","none"),i.Kd(b,d,c.start,c.pins,i.Hd/2-4,!1,12*i.Mc.song.channelOctaves[r]),i.Qc.appendChild(b)}}for(var p=0,f=i.oc.tones;p<f.length;p++)for(var c=f[p],g=0,v=c.notes;g<v.length;g++){var d=v[g],b=t.svgElement("path");b.setAttribute("fill",t.SongEditor.noteColorsDim[i.Mc.channel]),b.setAttribute("pointer-events","none"),i.Kd(b,d,c.start,c.pins,i.Hd/2+1,!1,i.nd),i.Qc.appendChild(b),b=t.svgElement("path"),b.setAttribute("fill",t.SongEditor.noteColorsBright[i.Mc.channel]),b.setAttribute("pointer-events","none"),i.Kd(b,d,c.start,c.pins,i.Hd/2+1,!0,i.nd),i.Qc.appendChild(b)}};for(var r=0;12>r;r++){var h=(12-r)%12,o=t.svgElement("rect");o.setAttribute("x","1"),o.setAttribute("y",""+(h*this.Uc+1)),o.setAttribute("height",""+(this.Uc-2)),o.setAttribute("fill",0==r?"#886644":"#444444"),this.Nc.appendChild(o),this.Wc[r]=o}this.Xc.setAttribute("x","1"),this.Xc.setAttribute("y","1"),this.Xc.setAttribute("height",""+(this.Vc-2)),this.Xc.setAttribute("fill","#444444"),this.Oc.appendChild(this.Xc),this.Mc.watch(this.Fd),this.Fd(),this.xd(),this.yd(),window.requestAnimationFrame(this.sd),this.Tc.addEventListener("mousedown",this.wd),document.addEventListener("mousemove",this.Ad),document.addEventListener("mouseup",this.Dd),this.Tc.addEventListener("mouseover",this.ud),this.Tc.addEventListener("mouseout",this.vd),this.Tc.addEventListener("touchstart",this.zd),document.addEventListener("touchmove",this.Cd),document.addEventListener("touchend",this.Dd),document.addEventListener("touchcancel",this.Dd)}return s.prototype.xd=function(){if(null!=this.oc&&(this.ld=new t.PatternCursor,!(this.$c<0||this.$c>this.td||this._c<0||this._c>this.Zc))){this.ld.part=Math.floor(Math.max(0,Math.min(this.Mc.song.beats*this.Mc.song.parts-1,this.$c/this.Gd)));for(var e=0,n=this.oc.tones;e<n.length;e++){var s=n[e];if(s.end<=this.ld.part)this.ld.prevTone=s,this.ld.curIndex++;else if(s.start<=this.ld.part&&s.end>this.ld.part)this.ld.curTone=s;else if(s.start>this.ld.part){this.ld.nextTone=s;break}}var i=this.Ld(this._c);if(null!=this.ld.curTone){this.ld.start=this.ld.curTone.start,this.ld.end=this.ld.curTone.end,this.ld.pins=this.ld.curTone.pins;for(var r=void 0,h=void 0,o=void 0,a=this.ld.curTone.pins[0],c=1;c<this.ld.curTone.pins.length;c++){o=a,a=this.ld.curTone.pins[c];var l=this.Gd*(this.ld.curTone.start+o.time),u=this.Gd*(this.ld.curTone.start+a.time);if(!(this.$c>u)){if(this.$c<l)throw new Error;var d=(this.$c-l)/(u-l),b=Math.sqrt(1/Math.sqrt(4)-Math.pow(d-.5,2))-.5,p=Math.abs(a.interval-o.interval);r=o.interval*(1-d)+a.interval*d,h=b*p+1;break}}for(var f=Number.MAX_VALUE,g=-Number.MAX_VALUE,v=Number.MAX_VALUE,m=0,M=this.ld.curTone.pins;m<M.length;m++){var y=M[m];f>y.interval&&(f=y.interval),g<y.interval&&(g=y.interval);var w=Math.abs(this.ld.curTone.start+y.time-this.$c/this.Gd);v>w&&(v=w,this.ld.nearPinIndex=this.ld.curTone.pins.indexOf(y))}i-=r,this.ld.note=this.Md(i,-f,(3==this.Mc.channel?t.Music.drumCount-1:t.Music.maxPitch)-g);for(var A=h,x=0;x<this.ld.curTone.notes.length;x++){var C=Math.abs(this.ld.curTone.notes[x]-i+.5);C>A||(A=C,this.ld.note=this.ld.curTone.notes[x])}for(var x=0;x<this.ld.curTone.notes.length;x++)if(this.ld.curTone.notes[x]==this.ld.note){this.ld.noteIndex=x;break}}else{this.ld.note=this.Md(i,0,t.Music.maxPitch);var E=this.Jd[this.Jd.length-1].time,k=Math.floor(this.ld.part/this.Mc.song.parts),j=E%this.Mc.song.parts,S=this.ld.part%this.Mc.song.parts;1==E?this.ld.start=this.ld.part:0==j?(this.ld.start=k*this.Mc.song.parts,this.Mc.song.parts>>1==this.Mc.song.parts/2&&S>this.Mc.song.parts/2&&E==this.Mc.song.parts&&(this.ld.start+=this.Mc.song.parts/2)):(this.ld.start=k*this.Mc.song.parts,j==this.Mc.song.parts/2?S>=this.Mc.song.parts/2&&(this.ld.start+=this.Mc.song.parts-j):S>this.Mc.song.parts/2&&(this.ld.start+=this.Mc.song.parts-j)),this.ld.end=this.ld.start+E;var P=0,T=this.Mc.song.beats*this.Mc.song.parts;if(null!=this.ld.prevTone&&(P=this.ld.prevTone.end),null!=this.ld.nextTone&&(T=this.ld.nextTone.start),this.ld.start<P?(this.ld.start=P,this.ld.end=this.ld.start+E,this.ld.end>T&&(this.ld.end=T)):this.ld.end>T&&(this.ld.end=T,this.ld.start=this.ld.end-E,this.ld.start<P&&(this.ld.start=P)),this.ld.end-this.ld.start==E)this.ld.pins=this.Jd;else{this.ld.pins=[];for(var L=0,B=this.Jd;L<B.length;L++){var I=B[L];if(!(I.time<=this.ld.end-this.ld.start)){this.ld.pins.push(new t.TonePin(0,this.ld.end-this.ld.start,I.volume));break}if(this.ld.pins.push(new t.TonePin(0,I.time,I.volume)),I.time==this.ld.end-this.ld.start)break}}}this.ld.valid=!0}},s.prototype.Ld=function(t){return Math.max(0,Math.min(this.Id-1,this.Id-t/this.Hd))+this.nd},s.prototype.Md=function(e,n,s){n>e&&(e=n),e>s&&(e=s);var i=t.Music.scaleFlags[this.Mc.song.scale];if(i[Math.floor(e)%12]||3==this.Mc.channel)return Math.floor(e);for(var r=Math.floor(e)+1,h=Math.floor(e)-1;!i[r%12];)r++;for(;!i[h%12];)h--;if(r>s)return n>h?n:h;if(n>h)return r;var o=r,a=h+1;return r%12!=0&&r%12!=7||(o-=.5),h%12!=0&&h%12!=7||(a+=.5),e-a>o-e?r:h},s.prototype.Ed=function(e){this.Jd=[];for(var n=0,s=e.pins;n<s.length;n++){var i=s[n];this.Jd.push(new t.TonePin(0,i.time,i.volume))}for(var r=1;r<this.Jd.length-1;)this.Jd[r-1].volume==this.Jd[r].volume&&this.Jd[r].volume==this.Jd[r+1].volume?this.Jd.splice(r,1):r++;this.ed[this.Mc.channel]=this.Jd},s.prototype.Bd=function(){var e,n;if(null!=this.oc)if(this.ad&&this.ld.valid){if(!this.cd){var s=this.$c-this.fd,i=this._c-this.gd;Math.sqrt(s*s+i*i)>5&&(this.cd=!0,this.dd=Math.abs(s)>=Math.abs(i))}if(this.cd){null!=this.kd&&(this.kd.undo(),this.kd=null);var r=Math.floor(this.$c/this.Gd),h=new t.ChangeSequence;if(null==this.ld.curTone){var o=void 0,a=void 0;r<this.ld.start?(o=!0,a=this.ld.start-r):(o=!1,a=r-this.ld.start+1);for(var c=1,l=0;l<=this.Mc.song.beats*this.Mc.song.parts;l++)if(!(l>=5&&l%this.Mc.song.parts!=0&&l!=3*this.Mc.song.parts/2&&l!=4*this.Mc.song.parts/3&&l!=5*this.Mc.song.parts/3)){var u=l;if(u==a){c=u;break}if(a>u&&(c=u),u>a){a-1>c&&(c=u);break}}o?(n=this.ld.start,e=n-c):(e=this.ld.start,n=e+c),0>e&&(e=0),n>this.Mc.song.beats*this.Mc.song.parts&&(n=this.Mc.song.beats*this.Mc.song.parts),h.append(new t.ChangeToneTruncate(this.Mc,this.oc,e,n));var d=void 0;for(d=0;d<this.oc.tones.length&&!(this.oc.tones[d].start>=n);d++);var b=new t.Tone(this.ld.note,e,n,3,3==this.Mc.channel);h.append(new t.ChangeToneAdded(this.Mc,this.oc,b,d)),this.Ed(b)}else if(this.dd){var p=Math.round((this.$c-this.fd)/this.Gd),f=this.ld.curTone.pins[this.ld.nearPinIndex],g=this.ld.curTone.start+f.time+p;0>g&&(g=0),g>this.Mc.song.beats*this.Mc.song.parts&&(g=this.Mc.song.beats*this.Mc.song.parts),g<=this.ld.curTone.start&&this.ld.nearPinIndex==this.ld.curTone.pins.length-1||g>=this.ld.curTone.end&&0==this.ld.nearPinIndex?h.append(new t.ChangeToneAdded(this.Mc,this.oc,this.ld.curTone,this.ld.curIndex,!0)):(e=Math.min(this.ld.curTone.start,g),n=Math.max(this.ld.curTone.end,g),h.append(new t.ChangeToneTruncate(this.Mc,this.oc,e,n,this.ld.curTone)),h.append(new t.ChangePinTime(this.Mc,this.ld.curTone,this.ld.nearPinIndex,g)),this.Ed(this.ld.curTone))}else if(-1==this.ld.noteIndex){for(var v=Math.round(Math.max(this.ld.curTone.start,Math.min(this.ld.curTone.end,this.$c/this.Gd)))-this.ld.curTone.start,m=void 0,M=this.ld.curTone.pins[0],y=void 0,w=void 0,d=1;d<this.ld.curTone.pins.length;d++)if(m=M,M=this.ld.curTone.pins[d],!(v>M.time)){if(v<m.time)throw new Error;var A=(v-m.time)/(M.time-m.time);y=Math.round(m.volume*(1-A)+M.volume*A+(this.gd-this._c)/25),0>y&&(y=0),y>3&&(y=3),w=this.Md(m.interval*(1-A)+M.interval*A+this.ld.curTone.notes[0],0,t.Music.maxPitch)-this.ld.curTone.notes[0];break}h.append(new t.ChangeVolumeBend(this.Mc,this.oc,this.ld.curTone,v,y,w)),this.Ed(this.ld.curTone)}else{var x=void 0,C=void 0;this.$c>=this.fd?(x=this.ld.part,C=r+1):(x=this.ld.part+1,C=r),0>C&&(C=0),C>this.Mc.song.beats*this.Mc.song.parts&&(C=this.Mc.song.beats*this.Mc.song.parts),C>this.ld.curTone.end&&h.append(new t.ChangeToneTruncate(this.Mc,this.oc,this.ld.curTone.start,C,this.ld.curTone)),C<this.ld.curTone.start&&h.append(new t.ChangeToneTruncate(this.Mc,this.oc,C,this.ld.curTone.end,this.ld.curTone));for(var E=Number.MAX_VALUE,k=-Number.MAX_VALUE,j=0,S=this.ld.curTone.notes;j<S.length;j++){var P=S[j];E>P&&(E=P),P>k&&(k=P)}E-=this.ld.curTone.notes[0],k-=this.ld.curTone.notes[0];var T=this.Md(this.Ld(this._c),-E,t.Music.maxPitch-k);h.append(new t.ChangePitchBend(this.Mc,this.ld.curTone,x,C,T,this.ld.noteIndex)),this.Ed(this.ld.curTone)}this.kd=h}this.hd=this.$c,this.jd=this._c}else this.xd(),this.yd()},s.prototype.yd=function(){this.bd&&!this.ad&&this.ld.valid&&null!=this.oc?(this.Sc.setAttribute("visibility","visible"),this.Kd(this.Sc,this.ld.note,this.ld.start,this.ld.pins,this.Hd/2+1,!0,this.nd)):this.Sc.setAttribute("visibility","hidden")},s.prototype.Kd=function(t,n,s,i,r,h,o){for(var a=i[0],c="M "+e(this.Gd*(s+a.time)+1)+" "+e(this.Nd(n-o)+r*(h?a.volume/3:1))+" ",l=1;l<i.length;l++){var u=a;a=i[l];var d=this.Gd*(s+u.time)+(1==l?1:0),b=this.Gd*(s+a.time)-(l==i.length-1?1:0),p=this.Nd(n+u.interval-o),f=this.Nd(n+a.interval-o),g=h?u.volume/3:1,v=h?a.volume/3:1;c+="L "+e(d)+" "+e(p-r*g)+" ",u.interval>a.interval&&(c+="L "+e(d+1)+" "+e(p-r*g)+" "),u.interval<a.interval&&(c+="L "+e(b-1)+" "+e(f-r*v)+" "),c+="L "+e(b)+" "+e(f-r*v)+" "}for(var l=i.length-2;l>=0;l--){var u=a;a=i[l];var d=this.Gd*(s+u.time)-(l==i.length-2?1:0),b=this.Gd*(s+a.time)+(0==l?1:0),p=this.Nd(n+u.interval-o),f=this.Nd(n+a.interval-o),g=h?u.volume/3:1,v=h?a.volume/3:1;c+="L "+e(d)+" "+e(p+r*g)+" ",u.interval<a.interval&&(c+="L "+e(d-1)+" "+e(p+r*g)+" "),u.interval>a.interval&&(c+="L "+e(b+1)+" "+e(f+r*v)+" "),c+="L "+e(b)+" "+e(f+r*v)+" "}c+="z",t.setAttribute("d",c)},s.prototype.Nd=function(t){return this.Hd*(this.Id-t-.5)},s}();t.PatternEditor=s}(beepbox||(beepbox={}));var beepbox;!function(t){var e=function(){function e(e,n,s){this.Od=t.html.text("1"),this.Pd=t.svgElement("text",{x:16,y:23,"font-family":"sans-serif","font-size":20,"text-anchor":"middle","font-weight":"bold",fill:"red"},[this.Od]),this.Qd=t.svgElement("rect",{width:30,height:30,x:1,y:1}),this.container=t.svgElement("svg",void 0,[this.Qd,this.Pd]),this.Rd=1,this.Sd=!1,this.Td=!1,this.container.setAttribute("x",""+32*n),this.container.setAttribute("y",""+32*s),this.Qd.setAttribute("fill","#444444"),this.Pd.setAttribute("fill",t.SongEditor.channelColorsDim[s])}return e.prototype.setSquashed=function(t,e){t?(this.container.setAttribute("y",""+27*e),this.Qd.setAttribute("height","25"),this.Pd.setAttribute("y","21")):(this.container.setAttribute("y",""+32*e),this.Qd.setAttribute("height","30"),this.Pd.setAttribute("y","23"))},e.prototype.setIndex=function(e,n,s,i){this.Rd!=e&&(this.Td||0==e==(0==this.Rd)||this.Qd.setAttribute("fill",0==e?"#000000":"#444444"),this.Rd=e,this.Od.data=""+e),this.Sd!=n&&(this.Sd=n,s?this.Pd.setAttribute("fill","#000000"):this.Pd.setAttribute("fill",n?t.SongEditor.channelColorsDim[i]:t.SongEditor.channelColorsBright[i])),this.Td!=s&&(this.Td=s,s?(this.Qd.setAttribute("fill",t.SongEditor.channelColorsBright[i]),this.Pd.setAttribute("fill","#000000")):(this.Qd.setAttribute("fill",0==this.Rd?"#000000":"#444444"),this.Pd.setAttribute("fill",n?t.SongEditor.channelColorsDim[i]:t.SongEditor.channelColorsBright[i])))},e}(),n=function(){function n(n,s){var i=this;this.Mc=n,this.Ud=s,this.td=512,this.Vd=32,this.Tc=t.svgElement("svg",{style:"background-color: #000000; position: absolute;",width:this.td,height:128}),this.container=t.html.div({style:"width: 512px; height: 128px; position: relative; overflow:hidden;"},[this.Tc]),this.ma=t.svgElement("rect",{fill:"white",x:0,y:0,width:4,height:128}),this.Wd=t.svgElement("rect",{fill:"none",stroke:"white","stroke-width":2,"pointer-events":"none",x:1,y:1,width:30,height:30}),this.Xd=t.svgElement("path",{fill:"black",stroke:"black","stroke-width":1,"pointer-events":"none"}),this.Yd=t.svgElement("path",{fill:"black",stroke:"black","stroke-width":1,"pointer-events":"none"}),this.Zd=[[],[],[],[]],this.$c=0,this._c=0,this.bd=!1,this.$d="",this.Zc=128,this._d=32,this.ae=!1,this.be=-1,this.sd=function(t){var e=i.Vd*(i.Mc.synth.playhead-i.Mc.barScrollPos)-2;i.be!=e&&(i.be=e,i.ma.setAttribute("x",""+e)),window.requestAnimationFrame(i.sd)},this.ud=function(t){i.bd||(i.bd=!0)},this.vd=function(t){i.bd&&(i.bd=!1)},this.wd=function(e){e.preventDefault();var n=i.Tc.getBoundingClientRect();i.$c=(e.clientX||e.pageX)-n.left,i._c=(e.clientY||e.pageY)-n.top;var s=Math.floor(Math.min(t.Music.numChannels-1,Math.max(0,i._c/i._d))),r=Math.floor(Math.min(i.Mc.song.bars-1,Math.max(0,i.$c/i.Vd+i.Mc.barScrollPos)));if(i.Mc.channel==s&&i.Mc.bar==r){var h=i._c%i._d<i._d/2,o=i.Mc.song.channelPatterns[s].length;i.ce((i.Mc.song.channelBars[s][r]+(h?1:o))%(o+1))}else i.de(s,r)},this.Ad=function(t){var e=i.Tc.getBoundingClientRect();i.$c=(t.clientX||t.pageX)-e.left,i._c=(t.clientY||t.pageY)-e.top,i.yd()},this.ee=function(t){},this.Fd=function(){i.oc=i.Mc.getCurrentPattern();var e=i.Mc.song.bars>16?108:128;i.Zc!=e&&(i.Zc=i.Mc.song.bars>16?108:128,i.Tc.setAttribute("height",""+i.Zc),i.container.style.height=""+i.Zc,i._d=i.Zc/t.Music.numChannels),i.fe()},this.oc=this.Mc.getCurrentPattern();for(var r=0;r<t.Music.numChannels;r++)for(var h=0;16>h;h++){var o=new e(r,h,r);this.Tc.appendChild(o.container),this.Zd[r][h]=o}this.Tc.appendChild(this.Wd),this.Tc.appendChild(this.Xd),this.Tc.appendChild(this.Yd),this.Tc.appendChild(this.ma),this.fe(),this.Mc.watch(this.Fd),window.requestAnimationFrame(this.sd),this.container.addEventListener("mousedown",this.wd),document.addEventListener("mousemove",this.Ad),document.addEventListener("mouseup",this.ee),this.container.addEventListener("mouseover",this.ud),this.container.addEventListener("mouseout",this.vd)}return n.prototype.de=function(e,n){var s=this.Mc.barScrollPos;this.Mc.history.getRecentChange()instanceof t.ChangeChannelBar&&this.Mc.history.undo(),this.Mc.barScrollPos=s,this.Mc.history.record(new t.ChangeChannelBar(this.Mc,e,n)),this.$d=""},n.prototype.ce=function(e){this.Mc.history.getRecentChange()instanceof t.ChangeBarPattern&&this.Mc.history.undo(),this.Mc.history.record(new t.ChangeBarPattern(this.Mc,e))},n.prototype.onKeyPressed=function(e){switch(e.keyCode){case 38:this.de((this.Mc.channel+3)%t.Music.numChannels,this.Mc.bar),e.preventDefault();break;case 40:this.de((this.Mc.channel+1)%t.Music.numChannels,this.Mc.bar),e.preventDefault();break;case 37:this.de(this.Mc.channel,(this.Mc.bar+this.Mc.song.bars-1)%this.Mc.song.bars),e.preventDefault();break;case 39:this.de(this.Mc.channel,(this.Mc.bar+1)%this.Mc.song.bars),e.preventDefault();break;case 48:this.ge("0"),e.preventDefault();break;case 49:this.ge("1"),e.preventDefault();break;case 50:this.ge("2"),e.preventDefault();break;case 51:this.ge("3"),e.preventDefault();break;case 52:this.ge("4"),e.preventDefault();break;case 53:this.ge("5"),e.preventDefault();break;case 54:this.ge("6"),e.preventDefault();break;case 55:this.ge("7"),e.preventDefault();break;case 56:this.ge("8"),e.preventDefault();break;case 57:this.ge("9"),e.preventDefault();break;default:this.$d=""}},n.prototype.ge=function(t){this.$d+=t;var e=parseInt(this.$d);return e<=this.Mc.song.patterns?void this.ce(e):(this.$d=t,e=parseInt(this.$d),e<=this.Mc.song.patterns?void this.ce(e):void(this.$d=""))},n.prototype.yd=function(){var e=Math.floor(Math.min(t.Music.numChannels-1,Math.max(0,this._c/this._d))),n=Math.floor(Math.min(this.Mc.song.bars-1,Math.max(0,this.$c/this.Vd+this.Mc.barScrollPos))),s=n==this.Mc.bar&&e==this.Mc.channel;if(this.bd&&!s?(this.Wd.setAttribute("x",""+(1+this.Vd*(n-this.Mc.barScrollPos))),this.Wd.setAttribute("y",""+(1+this._d*e)),this.Wd.setAttribute("height",""+(this._d-2)),this.Wd.style.visibility="visible"):this.Wd.style.visibility="hidden",this.bd&&s){var i=this._c%this._d<this._d/2,r=this.Vd*(n-this.Mc.barScrollPos+.8),h=this._d*(e+.5),o=.1*this._d,a=.4*this._d,c=.175*this._d;this.Xd.setAttribute("fill",i?"#fff":"#000"),this.Yd.setAttribute("fill",i?"#000":"#fff"),this.Xd.setAttribute("d","M "+r+" "+(h-a)+" L "+(r+c)+" "+(h-o)+" L "+(r-c)+" "+(h-o)+" z"),this.Yd.setAttribute("d","M "+r+" "+(h+a)+" L "+(r+c)+" "+(h+o)+" L "+(r-c)+" "+(h+o)+" z"),this.Xd.style.visibility="visible",this.Yd.style.visibility="visible"}else this.Xd.style.visibility="hidden",this.Yd.style.visibility="hidden"},n.prototype.fe=function(){var e=this.Mc.song.bars>16;if(this.ae!=e){this.ae=e;for(var n=0;n<t.Music.numChannels;n++)for(var s=0;16>s;s++)this.Zd[n][s].setSquashed(e,n)}for(var i=0;i<t.Music.numChannels;i++)for(var r=0;16>r;r++){var h=this.Mc.song.getPattern(i,r+this.Mc.barScrollPos),o=r+this.Mc.barScrollPos==this.Mc.bar&&i==this.Mc.channel,a=null==h||0==h.tones.length,c=this.Zd[i][r];r<this.Mc.song.bars?(c.setIndex(this.Mc.song.channelBars[i][r+this.Mc.barScrollPos],a,o,i),c.container.style.visibility="visible"):c.container.style.visibility="hidden"}this.yd()},n}();t.TrackEditor=n}(beepbox||(beepbox={}));var beepbox;!function(t){var e=function(){function e(e){var n=this;this.Mc=e,this.Vd=32,this.td=512,this.Zc=20,this.he=0,this.ie=1,this.je=2,this.ke=t.svgElement("path",{fill:"none",stroke:"#7744ff","stroke-width":4}),this.le=t.svgElement("path",{fill:"white","pointer-events":"none"}),this.Tc=t.svgElement("svg",{style:"background-color: #000000; touch-action: pan-y; position: absolute;",width:this.td,height:this.Zc},[this.ke,this.le]),this.me=t.html.canvas({width:"512",height:"20"}),this.ne=t.html.canvas({width:"512",height:"20"}),this.container=t.html.div({style:"width: 512px; height: 20px; position: relative;"},[this.Tc]),this.ld={},this.$c=0,this._c=0,this.ad=!1,this.bd=!1,this.oe=-1,this.pe=-1,this.ud=function(t){n.bd||(n.bd=!0,n.yd())},this.vd=function(t){n.bd&&(n.bd=!1,n.yd())},this.wd=function(t){t.preventDefault(),n.ad=!0;var e=n.Tc.getBoundingClientRect();n.$c=(t.clientX||t.pageX)-e.left,n._c=(t.clientY||t.pageY)-e.top,n.xd(),n.yd(),n.Ad(t)},this.zd=function(t){t.preventDefault(),n.ad=!0;var e=n.Tc.getBoundingClientRect();n.$c=t.touches[0].clientX-e.left,n._c=t.touches[0].clientY-e.top,n.xd(),n.yd(),n.Cd(t)},this.Ad=function(t){var e=n.Tc.getBoundingClientRect();n.$c=(t.clientX||t.pageX)-e.left,n._c=(t.clientY||t.pageY)-e.top,n.Bd()},this.Cd=function(t){if(n.ad){t.preventDefault();var e=n.Tc.getBoundingClientRect();n.$c=t.touches[0].clientX-e.left,n._c=t.touches[0].clientY-e.top,n.Bd()}},this.Dd=function(t){n.ad&&null!=n.qe&&(n.Mc.history.record(n.qe),n.qe=null),n.ad=!1,n.xd(),n.fe()},this.Fd=function(){n.fe()},this.xd(),this.fe(),this.Mc.watch(this.Fd),this.container.addEventListener("mousedown",this.wd),document.addEventListener("mousemove",this.Ad),document.addEventListener("mouseup",this.Dd),this.container.addEventListener("mouseover",this.ud),this.container.addEventListener("mouseout",this.vd),this.container.addEventListener("touchstart",this.zd),document.addEventListener("touchmove",this.Cd),document.addEventListener("touchend",this.Dd),document.addEventListener("touchcancel",this.Dd)}return e.prototype.xd=function(){var t=this.$c/this.Vd+this.Mc.barScrollPos;this.ld.startBar=t,t>this.Mc.song.loopStart-.25&&t<this.Mc.song.loopStart+this.Mc.song.loopLength+.25?t-this.Mc.song.loopStart<.5*this.Mc.song.loopLength?this.ld.mode=this.he:this.ld.mode=this.ie:this.ld.mode=this.je},e.prototype.re=function(t){var e=Math.round(t-this.Mc.song.loopLength/2),n=e+this.Mc.song.loopLength;return 0>e&&(n-=e,e=0),n>this.Mc.song.bars&&(e-=n-this.Mc.song.bars,n=this.Mc.song.bars),{start:e,length:n-e}},e.prototype.Bd=function(){if(this.ad){null!=this.qe&&this.qe.undo(),this.qe=null;var e=this.$c/this.Vd+this.Mc.barScrollPos,n=void 0,s=void 0,i=void 0;if(this.ld.mode==this.he)n=this.Mc.song.loopStart+Math.round(e-this.ld.startBar),s=this.Mc.song.loopStart+this.Mc.song.loopLength,n==s?n=s-1:n>s&&(i=n,n=s,s=i),0>n&&(n=0),s>=this.Mc.song.bars&&(s=this.Mc.song.bars),this.qe=new t.ChangeLoop(this.Mc,n,s-n);else if(this.ld.mode==this.ie)n=this.Mc.song.loopStart,s=this.Mc.song.loopStart+this.Mc.song.loopLength+Math.round(e-this.ld.startBar),s==n?s=n+1:n>s&&(i=n,n=s,s=i),0>n&&(n=0),s>=this.Mc.song.bars&&(s=this.Mc.song.bars),this.qe=new t.ChangeLoop(this.Mc,n,s-n);else if(this.ld.mode==this.je){var r=this.re(e);this.qe=new t.ChangeLoop(this.Mc,r.start,r.length)}}else this.xd(),this.yd()},e.prototype.yd=function(){var t=this.bd&&!this.ad;if(this.le.style.visibility=t?"visible":"hidden",t){var e=this.Zc/2,n=(this.Mc.song.loopStart-this.Mc.barScrollPos)*this.Vd,s=(this.Mc.song.loopStart+this.Mc.song.loopLength-this.Mc.barScrollPos)*this.Vd;if(this.ld.mode==this.he)s=(this.Mc.song.loopStart-this.Mc.barScrollPos)*this.Vd+2*e;else if(this.ld.mode==this.ie)n=(this.Mc.song.loopStart+this.Mc.song.loopLength-this.Mc.barScrollPos)*this.Vd-2*e;else{var i=this.re(this.ld.startBar);n=(i.start-this.Mc.barScrollPos)*this.Vd,s=(i.start+i.length-this.Mc.barScrollPos)*this.Vd}this.le.setAttribute("d","M "+(n+e)+" 4 "+("L "+(s-e)+" 4 ")+("A "+(e-4)+" "+(e-4)+" 0 0 1 "+(s-e)+" "+(this.Zc-4)+" ")+("L "+(n+e)+" "+(this.Zc-4)+" ")+("A "+(e-4)+" "+(e-4)+" 0 0 1 "+(n+e)+" 4 ")+"z")}},e.prototype.fe=function(){var t=this.Zc/2,e=(this.Mc.song.loopStart-this.Mc.barScrollPos)*this.Vd,n=(this.Mc.song.loopStart+this.Mc.song.loopLength-this.Mc.barScrollPos)*this.Vd;this.oe==e&&this.pe==n||(this.oe=e,this.pe=n,this.ke.setAttribute("d","M "+(e+t)+" 2 "+("L "+(n-t)+" 2 ")+("A "+(t-2)+" "+(t-2)+" 0 0 1 "+(n-t)+" "+(this.Zc-2)+" ")+("L "+(e+t)+" "+(this.Zc-2)+" ")+("A "+(t-2)+" "+(t-2)+" 0 0 1 "+(e+t)+" 2 ")+"z")),this.yd()},e}();t.LoopEditor=e}(beepbox||(beepbox={}));var beepbox;!function(t){var e=function(){function e(e){var n=this;this.Mc=e,this.td=512,this.Zc=20,this.se=t.svgElement("svg",{"pointer-events":"none"}),this.te=t.svgElement("rect",{fill:"#444444",x:0,y:2,width:10,height:this.Zc-4}),this.ue=t.svgElement("rect",{fill:"none",stroke:"white","stroke-width":2,"pointer-events":"none",x:0,y:1,width:10,height:this.Zc-2}),this.ve=t.svgElement("path",{fill:"white","pointer-events":"none"}),this.we=t.svgElement("path",{fill:"white","pointer-events":"none"}),this.Tc=t.svgElement("svg",{style:"background-color: #000000; touch-action: pan-y; position: absolute;",width:this.td,height:this.Zc},[this.se,this.te,this.ue,this.ve,this.we]),this.container=t.html.div({style:"width: 512px; height: 20px; overflow: hidden; position: relative;"},[this.Tc]),this.$c=0,this._c=0,this.ad=!1,this.bd=!1,this.xe=!1,this.ye=-1,this.ze=-1,this.ud=function(t){n.bd||(n.bd=!0,n.yd())},this.vd=function(t){n.bd&&(n.bd=!1,n.yd())},this.wd=function(t){t.preventDefault(),n.ad=!0;var e=n.Tc.getBoundingClientRect();n.$c=(t.clientX||t.pageX)-e.left,n._c=(t.clientY||t.pageY)-e.top,n.yd(),n.$c>=n.Mc.barScrollPos*n.Vd&&n.$c<=(n.Mc.barScrollPos+16)*n.Vd&&(n.xe=!0,n.Ae=n.$c)},this.zd=function(t){t.preventDefault(),n.ad=!0;var e=n.Tc.getBoundingClientRect();n.$c=t.touches[0].clientX-e.left,n._c=t.touches[0].clientY-e.top,n.yd(),n.$c>=n.Mc.barScrollPos*n.Vd&&n.$c<=(n.Mc.barScrollPos+16)*n.Vd&&(n.xe=!0,n.Ae=n.$c)},this.Ad=function(t){var e=n.Tc.getBoundingClientRect();n.$c=(t.clientX||t.pageX)-e.left,n._c=(t.clientY||t.pageY)-e.top,n.Bd()},this.Cd=function(t){if(n.ad){t.preventDefault();var e=n.Tc.getBoundingClientRect();n.$c=t.touches[0].clientX-e.left,n._c=t.touches[0].clientY-e.top,n.Bd()}},this.Dd=function(t){!n.xe&&n.ad&&(n.$c<(n.Mc.barScrollPos+8)*n.Vd?(n.Mc.barScrollPos>0&&n.Mc.barScrollPos--,n.Mc.changed()):(n.Mc.barScrollPos<n.Mc.song.bars-16&&n.Mc.barScrollPos++,n.Mc.changed())),n.ad=!1,n.xe=!1,n.yd()},this.Fd=function(){n.Vd=(n.td-1)/Math.max(16,n.Mc.song.bars),n.fe()},this.Mc.watch(this.Fd),this.Fd();var s=.5*this.Zc,i=20,r=9,h=6;this.ve.setAttribute("d","M "+r+" "+s+" L "+i+" "+(s+h)+" L "+i+" "+(s-h)+" z"),this.we.setAttribute("d","M "+(this.td-r)+" "+s+" L "+(this.td-i)+" "+(s+h)+" L "+(this.td-i)+" "+(s-h)+" z"),this.container.addEventListener("mousedown",this.wd),document.addEventListener("mousemove",this.Ad),document.addEventListener("mouseup",this.Dd),this.container.addEventListener("mouseover",this.ud),this.container.addEventListener("mouseout",this.vd),this.container.addEventListener("touchstart",this.zd),document.addEventListener("touchmove",this.Cd),document.addEventListener("touchend",this.Dd),document.addEventListener("touchcancel",this.Dd)}return e.prototype.Bd=function(){if(this.xe){for(;this.$c-this.Ae<.5*-this.Vd&&this.Mc.barScrollPos>0;)this.Mc.barScrollPos--,this.Ae-=this.Vd,this.Mc.changed();for(;this.$c-this.Ae>.5*this.Vd&&this.Mc.barScrollPos<this.Mc.song.bars-16;)this.Mc.barScrollPos++,this.Ae+=this.Vd,this.Mc.changed()}this.bd&&this.yd()},e.prototype.yd=function(){var t=this.bd&&!this.ad,e=!1,n=!1,s=!1;t&&(this.$c<this.Mc.barScrollPos*this.Vd?e=!0:this.$c>(this.Mc.barScrollPos+16)*this.Vd?n=!0:s=!0),this.ve.style.visibility=e?"visible":"hidden",this.we.style.visibility=n?"visible":"hidden",this.ue.style.visibility=s?"visible":"hidden"},e.prototype.fe=function(){var e=this.ye!=this.Mc.song.bars;if(e){for(this.ye=this.Mc.song.bars;this.se.firstChild;)this.se.removeChild(this.se.firstChild);for(var n=0;n<=this.Mc.song.bars;n++){var s=n%16==0?0:n%4==0?this.Zc/8:this.Zc/3;this.se.appendChild(t.svgElement("rect",{fill:"#444444",x:n*this.Vd-1,y:s,width:2,height:this.Zc-2*s}))}}(e||this.ze!=this.Mc.barScrollPos)&&(this.ze=this.Mc.barScrollPos,this.te.setAttribute("x",""+this.Vd*this.Mc.barScrollPos),this.te.setAttribute("width",""+16*this.Vd),this.ue.setAttribute("x",""+this.Vd*this.Mc.barScrollPos),this.ue.setAttribute("width",""+16*this.Vd)),this.yd()},e}();t.BarScrollBar=e}(beepbox||(beepbox={}));var beepbox;!function(t){var e=function(){function e(e){var n=this;this.Mc=e,this.td=20,this.Zc=481,this.Be=4,this.Ce=7,this.De=(this.Zc-this.Be)/this.Ce,this.Ee=3*this.De+this.Be,this.te=t.svgElement("rect",{fill:"#444444",x:2,y:0,width:this.td-4,height:this.Ee}),this.ue=t.svgElement("rect",{fill:"none",stroke:"white","stroke-width":2,"pointer-events":"none",x:1,y:0,width:this.td-2,height:this.Ee}),this.Xd=t.svgElement("path",{fill:"white","pointer-events":"none"}),this.Yd=t.svgElement("path",{fill:"white","pointer-events":"none"}),this.Tc=t.svgElement("svg",{style:"background-color: #000000; touch-action: pan-x; position: absolute;",width:this.td,height:this.Zc}),this.container=t.html.div({id:"octaveScrollBarContainer",style:"width: 20px; height: 481px; overflow: hidden; position: relative;"},[this.Tc]),this.$c=0,this._c=0,this.ad=!1,this.bd=!1,this.xe=!1,this.Fe=-1,this.ud=function(t){n.bd||(n.bd=!0,n.yd())},this.vd=function(t){n.bd&&(n.bd=!1,n.yd())},this.wd=function(t){t.preventDefault(),n.ad=!0;var e=n.Tc.getBoundingClientRect();n.$c=(t.clientX||t.pageX)-e.left,n._c=(t.clientY||t.pageY)-e.top,3!=n.Mc.channel&&(n.yd(),n._c>=n.Ge-n.Ee&&n._c<=n.Ge&&(n.xe=!0,n.Ae=n._c))},this.zd=function(t){t.preventDefault(),n.ad=!0;var e=n.Tc.getBoundingClientRect();n.$c=t.touches[0].clientX-e.left,n._c=t.touches[0].clientY-e.top,3!=n.Mc.channel&&(n.yd(),n._c>=n.Ge-n.Ee&&n._c<=n.Ge&&(n.xe=!0,n.Ae=n._c))},this.Ad=function(t){var e=n.Tc.getBoundingClientRect();n.$c=(t.clientX||t.pageX)-e.left,n._c=(t.clientY||t.pageY)-e.top,n.Bd()},this.Cd=function(t){if(n.ad){t.preventDefault();var e=n.Tc.getBoundingClientRect();n.$c=t.touches[0].clientX-e.left,n._c=t.touches[0].clientY-e.top,n.Bd()}},this.Dd=function(e){3!=n.Mc.channel&&!n.xe&&n.ad&&(n._c<n.Ge-.5*n.Ee?n.He<4&&n.Mc.history.record(new t.ChangeOctave(n.Mc,n.He+1)):n.He>0&&n.Mc.history.record(new t.ChangeOctave(n.Mc,n.He-1))),n.ad=!1,n.xe=!1,n.yd()},this.Fd=function(){n.He=n.Mc.song.channelOctaves[n.Mc.channel],n.Ge=n.Zc-n.De*n.He,n.fe()},this.Mc.watch(this.Fd),this.Fd(),this.Tc.appendChild(this.te);for(var s=0;s<=this.Ce;s++)this.Tc.appendChild(t.svgElement("rect",{fill:"#886644",x:0,y:s*this.De,width:this.td,height:this.Be}));this.Tc.appendChild(this.ue),this.Tc.appendChild(this.Xd),this.Tc.appendChild(this.Yd);var i=.5*this.td,r=20,h=9,o=6;this.Xd.setAttribute("d","M "+i+" "+h+" L "+(i+o)+" "+r+" L "+(i-o)+" "+r+" z"),this.Yd.setAttribute("d","M "+i+" "+(this.Zc-h)+" L "+(i+o)+" "+(this.Zc-r)+" L "+(i-o)+" "+(this.Zc-r)+" z"),this.container.addEventListener("mousedown",this.wd),document.addEventListener("mousemove",this.Ad),document.addEventListener("mouseup",this.Dd),this.container.addEventListener("mouseover",this.ud),this.container.addEventListener("mouseout",this.vd),this.container.addEventListener("touchstart",this.zd),document.addEventListener("touchmove",this.Cd),document.addEventListener("touchend",this.Dd),document.addEventListener("touchcancel",this.Dd)}return e.prototype.Bd=function(){if(3!=this.Mc.channel){if(this.xe){for(;this._c-this.Ae<.5*-this.De&&this.He<4;)this.Mc.history.record(new t.ChangeOctave(this.Mc,this.He+1)),this.Ae-=this.De;for(;this._c-this.Ae>.5*this.De&&this.He>0;)this.Mc.history.record(new t.ChangeOctave(this.Mc,this.He-1)),this.Ae+=this.De}this.bd&&this.yd()}},e.prototype.yd=function(){var t=this.bd&&!this.ad,e=!1,n=!1,s=!1;t&&(this._c<this.Ge-this.Ee?e=!0:this._c>this.Ge?n=!0:s=!0),this.Xd.style.visibility=e?"visible":"hidden",this.Yd.style.visibility=n?"visible":"hidden",this.ue.style.visibility=s?"visible":"hidden"},e.prototype.fe=function(){this.Tc.style.visibility=3==this.Mc.channel?"hidden":"visible",this.Fe!=this.Ge&&(this.Fe=this.Ge,this.te.setAttribute("y",""+(this.Ge-this.Ee)),this.ue.setAttribute("y",""+(this.Ge-this.Ee))),this.yd()},e}();t.OctaveScrollBar=e}(beepbox||(beepbox={}));var beepbox;!function(t){function e(){n++,s=!0}var n=0,s=!1,i=document.createElement("img");i.onload=e,
i.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAANCAIAAABHKvtLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NEU3RTM2RTg0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NEU3RTM2RTk0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDozMzYxN0U3RDQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDozMzYxN0U3RTQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PomGIaQAAABgSURBVHjaYpSWlmZhYWFmZgaSTExMQAYTGGAyIICRkRFIMhANWISFhdlggAUHANrBysoKNBfuCGKMvnjx4r59+xhp5wOg6UCSBM+SB0YtGLVgCFgAzDeMeOSGgAUAAQYAGgwJrOg8pdQAAAAASUVORK5CYII=";var r=document.createElement("img");r.onload=e,r.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAANCAIAAABHKvtLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NEU3RTM2RUM0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NEU3RTM2RUQ0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo0RTdFMzZFQTQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo0RTdFMzZFQjQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PhURscAAAAB1SURBVHja7NPBCoAgDAZgnaMX8Oj7P2KKldXPhiR4CwwCv4PInPvxoA0hMLNzDisRYUPCCiMucVallJzzJnaBih5pp2mw936puKEZ2qQ3MeUQmLiKGGNKCZ1IQr2fDnb0C8gMNgNmwA8Cnt/0Tv91vw64BRgALUuP70jrlrwAAAAASUVORK5CYII=";var h=document.createElement("img");h.onload=e,h.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAANCAIAAABHKvtLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MzM2MTdFNzc0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MzM2MTdFNzg0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDozMzYxN0U3NTQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDozMzYxN0U3NjQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgBmMXoAAACTSURBVHja7JQ7CgMhGIT3920M2Hko7+RJPYWViE0myi5sEXAhKQL7FcP8PmawkWKMjx2llNb60MNIKY0xnPPphRDbMsJ7/xw458wAodZa6PRQ5GIF0RjlYCU655xSEqWU3ntrrdb63RcgHcq2H3MX3AV/UEAhBL7DBkTEzmAFuzSY44UC/BDHtU+8z539esFLgAEAkZ4XCDjZXPEAAAAASUVORK5CYII=";var o=document.createElement("img");o.onload=e,o.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAANCAIAAABHKvtLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MzM2MTdFN0I0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MzM2MTdFN0M0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDozMzYxN0U3OTQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDozMzYxN0U3QTQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PlZjoH4AAADHSURBVHja7JTNDoMgEIRBGq21iTcfyvd/DeNvJBYBp7uFEE+99NDE70AMMDPLYZRt2z4CeZ4XRcFrRkgphRD7vnvvX8RGdF03DEPf99M0LcuitcamMcZa6wkRuNV1/SSqqroTcC/LEu5KKQ6AEhq21oRzDl5bAME8DUjd3wHjOELPyu9fgNnneV7XNQ6OyNPsTCZ+zBVwBfxBgGyaRgViuWIt+ZIPuAAaZwh00BKxaKeuSfwhUsfI55g+WOMT2DEl3jm94BBgAAtY6T6d3wTNAAAAAElFTkSuQmCC";var a=document.createElement("img");a.onload=e,a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAArCAIAAACW3x1gAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowMTgwMTE3NDA3MjA2ODExOUJCOEEzOUJCMkI3MTdFNCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo5NzVEOTA1QzQ5MjMxMUUxOTM3RDhDNEI4QkIxQkFCNSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo5NzVEOTA1QjQ5MjMxMUUxOTM3RDhDNEI4QkIxQkFCNSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjAxODAxMTc0MDcyMDY4MTE5QkI4QTM5QkIyQjcxN0U0IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjAxODAxMTc0MDcyMDY4MTE5QkI4QTM5QkIyQjcxN0U0Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+dtFK5QAACbRJREFUeNrcV0lsG9cZnnmzcJdIcRHFRZtly5IVSVYSOcriNY7jqHHTBE2bJkCRNijQQ9re2kOBAj30kByKAm1PvQVF0RYIkLRpkiZuLMqyLVm7bGvlIpKiuHOGyww52+ubIbXYCYLk2P4ccobz3nzf+9f3D4b9rwv+5cOXL5x48crDT54b8Pr6jOZWQJoxKIi13WJ+Oziz+Z/r6x9N3AvMhb42gcWkf/P1Mz/40fkWz2iuAAsFrljkOK5crVYwTNTrcaMRNDURNhtl1Slrn9x55x+zf/5ooVIVvhLBq1ce+eXPLpt6RnZ22EIBmk1Oi8VuMFoMBgNF6RUMF2tcrVqscPlSKcGV4zaC85qNd25u/PHdm/+8tf5lBBRJ/Oan49/98cVEDmcYg9PZ09LSrjcYSRzHcAAxDGBQQfMgJiuyAiFUFMSUT23mtu9YxYxVgX/6YPa3796QZGUfk9i/Mhvo3//8W99443wwKtB0T1fXqM3m0en0iJUgSIIkKYoiKBL9A4QqAEcCSFJnbnI3uboqIpHP7D7T73WYDbfW4+IexwHB22+OX3zpsfAu5nI96vUM0gY9wqN0JEJG2AAATFs7hlABrhKgk3qJQwwCgrY4/ZiuaSceO+VvslkM11Yi9xG8+dLj33/tdDgLPB1POB09JE0RAOESFEEiVOWQaIZBPxCtX2MBUKVRMAXTWZyk2RaPRp440lIV5PngboPgZE/br16/kBJwR9dTTtdxQkejBzUOoHxO4P2CCAgcV+8iDSHUWWyA0ieDa4N++1J4N8VUVMVfvTCEm/S0vc/Z1g9IoKIjU6PHkCBvyrJ63hMJffZ+tQkyDnDVPThR18beM6zvHmky0i8/OYDAwTGvfXz0WKoCXL5BFVv1p0qgmULRMJTD0HVKWdqj1EZVS2meV+MNU1zHTmZE6tLJ7qOeFvLMQ504TRkt3SarC00j1aOBrhmksUxFu4PuNxytAqHAhZj2Bw2h6Kprgym40d5m9PXqmbXTA53gzIA/V+KaXZ3aTBSCuKrpniDMOo+yv/bGr3qCyv46VE8jDVCmIBT0t7mtK1fkn+rzgpPdrWy5arS2qloCXHMWdp8flYatZGVPm7rd7nc6psUV0BgQgsnhYbnacGcr8DltXE3UGZsxFNA4JAgcUzU/RHDoWsOFh2Pp8ES0OnX9anWAtNnK1wSf00paTIZG0UAhV19+4/uAHNCqc2Hj3n2CDCxDWRvU1FCLJuB43qijahyLiFG2wEZ5wr+gLOKac7USUX/+gVlQ1pahsdZKjEFHcxwPWIZpNus5JgUhPICqY+1B4XvAQItHrUjsDR6aiRRT9gAq2USzUccyLNhNpe0WI5uOYFrEoAPDDqHvoSJMcJ8Q+7f3J6rxIGP1hbKJsN1iQOAgtJNutZu5bKjEpmU1HNXQeABcKzsNIfeKqVbv8H0OLbCgamQIuXySS6y7rOZQIgO2M2WsxrealHRsSdEiW5Kkfez6uV47Dyg0+ANzgUbqIAfXDZBZn3eSoiJUorkyoMzW9bW1Tk+LkFtNJ1YQPApESZFAAxqAQ9jEYZK6aKPItJJaPdRPdmupGlnocDWvra4hcHCi7/jdxXtihe3yWFKx2+lsUJZESVKLxAH2F1A0wNEAsrooC5Ko5ggb38wsBbps+mqZXVxZHeg7Dvq7vYlo+c78vN9t7fSARPxmMrmuCKIgSfUqRnwxeEOQZQRBRnpDWcxur6QWPm3XcT67eX5uLrHD93V5SSOsWk2ttwMLNp9rePwiyZbC0Vs8X/R5T+gNFog41F2SOEjdevRrXhVFUS2sklTjSsmt21xw7ogZ8za3XEcyvdzS3KOXeeInlx9iC3IikqkKCZ2ROjr6kKXJVCjsRqMx9CRBGpHBkWXrW1g9nRG0pNpRRGav8Gw6thy995mhuHW81eSxmK4HpiYnrzNFU9+xXp/XQLz8aIel2RqeTZZrNVHYJYDi7u7s6OqkaaJQSEajYYbJ8xwvSgJaLDI3YuW5EsNkc7lIYmchEbtJC9tHHFS/z6GUuclrE4GJwG6BBpJ1bKy3WGXJ5WDs+WfOOX0t+UgmaqieOM1uXP2Xb/iUv+Nhv7+DYYRstlIoZLYj259rvMg2D+mwuq2ohjL81vTC8tQ0hyk7eRpyTd52W09P6/uBKXLmXuSlK7D3VM+tSAZugv7Lb3349otCOe3OxW3+oWb7gNXqwDAdhqHdX0I1BsNQ+8ZjWBXDOHQh88XY3EpoZml1ZjGdLP/ivX9cffcVtKcPDXdStHJ7bZtcjGS2Ntb7xwbDs2F2K4UX37rzMcOOQoN5RSpuNbnnjPYjlMkP6DaIm1AfpDZdQqlWSVVyMSYeTm5sJtZCHMOHd2q7O2T449+hXdPvd5wc7tpYX12OZslIEd6YWe4a7h+8PHT9D5/GVxhXEiTey2eC1aOnnINnUUuUx2vLtIGUqlKVq/FlgWf5ClstM1yF4Zk0F4zUIiGhkiLNgNxeLaDUfvzxXkAIgfmV7TJGcBJGSJUeFz36wllBlP/+6+suknQSlCGthGfyK7PpWKhcydckUYtRHBN5KZ/m4qHS+jK7OFNYmC6mNyRzlTIRSDlseT537uzApUvDk4HAX29s3C2olsUWk9K/r06jPBj94WmlJu68v4RuNpGEkzLCNJbbza98mL4qiowsj35vOLZVWL8VpnFcDwA6/AQt62FVwQSo7iVjj/WOP/fwzVs3PpicvVuAjcarJKhrawM5i8My+NoFqSxVtlKEApE1DQA4KKqd1nXrdb1Gw/jf/jL2/KPyO5+00bSVotCoorkexS9OkWPnB158eWxpbnYiEPgsrmyyh1rHGCOhztkF07SJOHrlrMnTVo3nFKaCdmgSRxs56kXU3a79lZ3NTz/JLORFXkG4yGwSVNFt7Y6nvzM2dubo7NTUxLVrEzH5Zgo+2PyGswJqarwUq0gV92ivf/wSbbFIGRayZVSP1WqM47pHbKH5TC3MCRW5TmBpt498e/TZN85RRHn6s4mF2flAVJ5Mavb6/K6K2pZvPuZ45ZK364jTfXzE2j5EQn95LsyvbJXWQ+VofDIci4vC00d9lMdlOuZ2DHndI242EgqjPJheiCdLE1vVqYSswC99wznVZ33hvOfKxQ5Ts6HJ3X0oD8xaHlQVoVCrJCq5OLMTSm5sJO4FObY6tVqcCnJrWfkrvaPpaXBxzP3sOd9zT3fYXSa9kab0lFhFVRPlAepAahUWJUEV5UE2XZ5azE6vl+YivCDDr/2WOdzfcmqkdWTINXDC4XXpzTqiWq7F42wwyKxuFO5sMneDxc0Ej/0/y38FGACBHjS0mkQ17AAAAABJRU5ErkJggg==";var c=function(){function e(e){var n=this;this.Mc=e,this.me=t.html.canvas({width:"32",height:"481"}),this.ne=t.html.canvas({width:"32",height:"40"}),this.container=t.html.div({style:"width: 32px; height: 481px; overflow:hidden; position: relative;"},[this.me,this.ne]),this.Ie=this.me.getContext("2d"),this.Je=this.ne.getContext("2d"),this.td=32,this.Zc=481,this.$c=0,this._c=0,this.ad=!1,this.bd=!1,this.Ke=-1,this.rd=!1,this.Le=-1,this.ud=function(t){n.bd||(n.bd=!0,n.yd())},this.vd=function(t){n.bd&&(n.bd=!1,n.yd())},this.wd=function(t){t.preventDefault(),n.ad=!0;var e=n.me.getBoundingClientRect();n.$c=(t.clientX||t.pageX)-e.left,n._c=(t.clientY||t.pageY)-e.top,n.Mc.synth.pianoPressed=!0,n.yd()},this.Ad=function(t){var e=n.me.getBoundingClientRect();n.$c=(t.clientX||t.pageX)-e.left,n._c=(t.clientY||t.pageY)-e.top,n.Me(),n.Mc.synth.pianoNote=n.Ne+12*n.Mc.song.channelOctaves[n.Mc.channel],n.yd()},this.ee=function(t){n.ad=!1,n.Mc.synth.pianoPressed=!1,n.yd()},this.Fd=function(){n.Hd=3==n.Mc.channel?40:13,n.Id=3==n.Mc.channel?t.Music.drumCount:t.Music.noteCount,n.Me(),n.Mc.synth.pianoNote=n.Ne+12*n.Mc.song.channelOctaves[n.Mc.channel],n.Mc.synth.pianoChannel=n.Mc.channel,n.fe()},this.fe=function(){if(!s)return void window.requestAnimationFrame(n.fe);if(n.Mc.showLetters&&(n.Ke!=n.Mc.song.scale||n.Le!=n.Mc.song.key||n.rd!=(3==n.Mc.channel))){n.Ke=n.Mc.song.scale,n.Le=n.Mc.song.key,n.rd=3==n.Mc.channel,n.Ie.clearRect(0,0,n.td,n.Zc);for(var e,c=0;c<n.Id;c++){var l=(c+t.Music.keyTransposes[n.Mc.song.key])%12;if(3==n.Mc.channel){e=a;var u=1-c/n.Id*.35,d=.5*(1-u),b=e.width*d,p=e.height*d+n.Hd*(n.Id-c-1),f=e.width*u,g=e.height*u;n.Ie.drawImage(e,b,p,f,g);for(var v=1+(c-n.Id/2)/n.Id*.5,m=n.Ie.getImageData(b,p,f,g),M=m.data,y=0;y<M.length;y+=4)M[y+0]*=v,M[y+1]*=v,M[y+2]*=v;n.Ie.putImageData(m,b,p)}else if(t.Music.scaleFlags[n.Mc.song.scale][c%12]){var w=t.Music.noteNames[l];if(null==w){var A=t.Music.blackKeyNameParents[c%12];w=t.Music.noteNames[(l+12+A)%12],1==A?w+="♭":-1==A&&(w+="♯")}var x=t.Music.pianoScaleFlags[l]?"#000000":"#ffffff";e=t.Music.pianoScaleFlags[l]?h:i,n.Ie.drawImage(e,0,n.Hd*(n.Id-c-1)),n.Ie.font="bold 11px sans-serif",n.Ie.fillStyle=x,n.Ie.fillText(w,15,n.Hd*(n.Id-c)-3)}else e=t.Music.pianoScaleFlags[l]?o:r,n.Ie.drawImage(e,0,n.Hd*(n.Id-c-1))}n.yd()}},this.Mc.watch(this.Fd),this.Fd(),this.container.addEventListener("mousedown",this.wd),document.addEventListener("mousemove",this.Ad),document.addEventListener("mouseup",this.ee),this.container.addEventListener("mouseover",this.ud),this.container.addEventListener("mouseout",this.vd)}return e.prototype.Me=function(){var e=t.Music.scaleFlags[this.Mc.song.scale],n=Math.max(0,Math.min(this.Id-1,this.Id-this._c/this.Hd));if(e[Math.floor(n)%12]||3==this.Mc.channel)this.Ne=Math.floor(n);else{for(var s=Math.floor(n)+1,i=Math.floor(n)-1;!e[s%12];)s++;for(;!e[i%12];)i--;var r=s,h=i+1;s%12!=0&&s%12!=7||(r-=.5),i%12!=0&&i%12!=7||(h+=.5),this.Ne=n-h>r-n?s:i}},e.prototype.yd=function(){this.ne.style.visibility=!this.bd||this.ad?"hidden":"visible",this.bd&&!this.ad&&(this.Je.clearRect(0,0,32,40),this.ne.style.left="0px",this.ne.style.top=this.Hd*(this.Id-this.Ne-1)+"px",this.Je.lineWidth=2,this.Je.strokeStyle="#ffffff",this.Je.strokeRect(1,1,this.td-2,this.Hd-2))},e}();t.Piano=c}(beepbox||(beepbox={}));var beepbox;!function(t){var e=t.html.button,n=t.html.div,s=t.html.span,i=t.html.input,r=t.html.br,h=t.html.text,o=function(){function o(a,c){var l=this;this.Mc=a,this.Ud=c,this.Oe=i({style:"width: 3em; margin-left: 1em;",type:"number",min:"1",max:"128",step:"1"}),this.Pe=i({style:"width: 3em; margin-left: 1em;",type:"number",min:"1",max:"128",step:"1"}),this.Qe=i({style:"width: 3em; margin-left: 1em;",type:"number",min:"1",max:"32",step:"1"}),this.Re=i({style:"width: 3em; margin-left: 1em;",type:"number",min:"1",max:"10",step:"1"}),this.Se=e({style:"width:45%;"},[h("Okay")]),this.Te=e({style:"width:45%;"},[h("Cancel")]),this.container=n({className:"prompt",style:"width: 250px;"},[n({style:"font-size: 2em"},[h("Custom Song Size")]),n({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},[n({style:"text-align: right;"},[h("Beats per bar:"),r(),s({style:"font-size: smaller; color: #888888;"},[h("(Multiples of 3 or 4 are recommended)")])]),this.Oe]),n({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},[n({style:"display: inline-block; text-align: right;"},[h("Bars per song:"),r(),s({style:"font-size: smaller; color: #888888;"},[h("(Multiples of 2 or 4 are recommended)")])]),this.Pe]),n({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},[h("Patterns per channel:"),this.Qe]),n({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},[h("Instruments per channel:"),this.Re]),n({style:"display: flex; flex-direction: row; justify-content: space-between;"},[this.Se,this.Te])]),this.Ue=function(){l.Ud.closePrompt(l),l.Se.removeEventListener("click",l.Ve),l.Te.removeEventListener("click",l.Ue),l.Oe.removeEventListener("keypress",o.We),l.Pe.removeEventListener("keypress",o.We),l.Qe.removeEventListener("keypress",o.We),l.Re.removeEventListener("keypress",o.We),l.Oe.removeEventListener("blur",o.Xe),l.Pe.removeEventListener("blur",o.Xe),l.Qe.removeEventListener("blur",o.Xe),l.Re.removeEventListener("blur",o.Xe)},this.Ve=function(){var e=new t.ChangeSequence;e.append(new t.ChangeBeats(l.Mc,o.Ye(l.Oe))),e.append(new t.ChangeBars(l.Mc,o.Ye(l.Pe))),e.append(new t.ChangePatterns(l.Mc,o.Ye(l.Qe))),e.append(new t.ChangeInstruments(l.Mc,o.Ye(l.Re))),l.Mc.history.record(e),l.Ue()},this.Oe.value=this.Mc.song.beats+"",this.Oe.min=t.Music.beatsMin+"",this.Oe.max=t.Music.beatsMax+"",this.Pe.value=this.Mc.song.bars+"",this.Pe.min=t.Music.barsMin+"",this.Pe.max=t.Music.barsMax+"",this.Qe.value=this.Mc.song.patterns+"",this.Qe.min=t.Music.patternsMin+"",this.Qe.max=t.Music.patternsMax+"",this.Re.value=this.Mc.song.instruments+"",this.Re.min=t.Music.instrumentsMin+"",this.Re.max=t.Music.instrumentsMax+"",this.Se.addEventListener("click",this.Ve),this.Te.addEventListener("click",this.Ue),this.Oe.addEventListener("keypress",o.We),this.Pe.addEventListener("keypress",o.We),this.Qe.addEventListener("keypress",o.We),this.Re.addEventListener("keypress",o.We),this.Oe.addEventListener("blur",o.Xe),this.Pe.addEventListener("blur",o.Xe),this.Qe.addEventListener("blur",o.Xe),this.Re.addEventListener("blur",o.Xe)}return o.We=function(t){var e=t.which?t.which:t.keyCode;return 46!=e&&e>31&&(48>e||e>57)?(t.preventDefault(),!0):!1},o.Xe=function(t){var e=t.target;e.value=Math.floor(Math.max(Number(e.min),Math.min(Number(e.max),Number(e.value))))+""},o.Ye=function(t){return Math.floor(Number(t.value))},o}();t.SongDurationPrompt=o}(beepbox||(beepbox={}));var beepbox;!function(t){var e=t.html.button,n=t.html.div,s=t.html.input,i=t.html.text,r=function(t,e){if(navigator.msSaveOrOpenBlob)return void navigator.msSaveOrOpenBlob(t,e);var n=document.createElement("a");if(void 0!=n.download){var s=URL.createObjectURL(t);setTimeout(function(){URL.revokeObjectURL(s)},6e4),n.href=s,n.download=e,n.dispatchEvent(new MouseEvent("click"))}else if(navigator.vendor.indexOf("Apple")>-1){var i=new FileReader;i.onloadend=function(){console.log(i.result);var t=i.result.replace(/^data:[^;]*;/,"data:attachment/file;");window.open(t,"_blank")||(window.location.href=t)},i.readAsDataURL(t)}else{var r=URL.createObjectURL(t);setTimeout(function(){URL.revokeObjectURL(r)},6e4),window.open(r,"_blank")||(window.location.href=r)}};ArrayBuffer.transfer||(ArrayBuffer.transfer=function(t,e){function n(t,e,n,s,i){var r=Uint8Array;switch(t){case 8:r=Float64Array;break;case 4:r=Float32Array;break;case 2:r=Uint16Array;break;case 1:r=Uint8Array;break;default:r=Uint8Array}for(var h=new r(e,s,i/t|0),o=new r(n,s,i/t|0),a=0;a<o.length;a++)o[a]=h[a];return{nextOffset:h.byteOffset+h.byteLength,leftBytes:i-o.length*t}}var s=new ArrayBuffer(e);if(!(t instanceof ArrayBuffer&&s instanceof ArrayBuffer))throw new TypeError("Source and destination must be ArrayBuffer instances");for(var i=0,r=Math.min(t.byteLength,s.byteLength),h=[8,4,2,1],o=0,a=h;o<a.length;o++){var c=a[o];if(r>=c){var l=n(c,t,s,i,r);i=l.nextOffset,r=l.leftBytes}}return s});var h=function(){function h(o,a){var c=this;this.Mc=o,this.Ud=a,this.Ze=s({type:"text",style:"width: 10em;",value:"BeepBox-Song",maxlength:250}),this.$e=s({type:"checkbox"}),this._e=s({style:"width: 2em;",type:"number",min:"1",max:"4",step:"1"}),this.af=s({type:"checkbox"}),this.bf=e({},[i("Export to .wav file")]),this.cf=e({},[i("Export to .midi file")]),this.df=e({},[i("Export to .json file")]),this.Te=e({},[i("Cancel")]),this.container=n({className:"prompt",style:"width: 200px;"},[n({style:"font-size: 2em"},[i("Export Options")]),n({style:"display: flex; flex-direction: row; align-items: center; justify-content: space-between;"},[i("File name:"),this.Ze]),n({style:"display: table; width: 100%;"},[n({style:"display: table-row;"},[n({style:"display: table-cell;"},[i("Intro:")]),n({style:"display: table-cell;"},[i("Loop Count:")]),n({style:"display: table-cell;"},[i("Outro:")])]),n({style:"display: table-row;"},[n({style:"display: table-cell; vertical-align: middle;"},[this.$e]),n({style:"display: table-cell; vertical-align: middle;"},[this._e]),n({style:"display: table-cell; vertical-align: middle;"},[this.af])])]),this.bf,this.cf,this.df,this.Te]),this.Ue=function(){c.Ud.closePrompt(c),c.Ze.removeEventListener("input",h.ef),c._e.removeEventListener("blur",h.Xe),c.bf.removeEventListener("click",c.ff),c.cf.removeEventListener("click",c.gf),c.df.removeEventListener("click",c.hf),c.Te.removeEventListener("click",c.Ue)},this.ff=function(){var e=new t.Synth(c.Mc.song);if(e.enableIntro=c.$e.checked,e.enableOutro=c.af.checked,e.loopCount=Number(c._e.value),!e.enableIntro)for(var n=0;n<c.Mc.song.loopStart;n++)e.nextBar();var s=e.totalSamples,i=new Float32Array(s);e.synthesize(i,s);var h=1,o=1,a=44100,l=2,u=8*l,d=o*s,b=44+d*l,p=0,f=new ArrayBuffer(b),g=new DataView(f);g.setUint32(p,1380533830,!1),p+=4,g.setUint32(p,36+d*l,!0),p+=4,g.setUint32(p,1463899717,!1),p+=4,g.setUint32(p,1718449184,!1),p+=4,g.setUint32(p,16,!0),p+=4,g.setUint16(p,1,!0),p+=2,g.setUint16(p,o,!0),p+=2,g.setUint32(p,a,!0),p+=4,g.setUint32(p,a*l*o,!0),p+=4,g.setUint16(p,l,!0),p+=2,g.setUint16(p,u,!0),p+=2,g.setUint32(p,1684108385,!1),p+=4,g.setUint32(p,d*l,!0),p+=4;var v,m;h==o?(v=1,m=1):(v=h,m=o);var M;if(l>1)for(var y=0;s>y;y++){M=Math.floor(i[y*v]*((1<<u-1)-1));for(var w=0;m>w;w++)if(2==l)g.setInt16(p,M,!0),p+=2;else{if(4!=l)throw new Error("unsupported sample size");g.setInt32(p,M,!0),p+=4}}else for(var y=0;s>y;y++){M=Math.floor(127*i[y*v]+128);for(var w=0;m>w;w++)g.setUint8(p,M>255?255:0>M?0:M),p++}var A=new Blob([f],{type:"audio/wav"});r(A,c.Ze.value.trim()+".wav"),c.Ue()},this.gf=function(){function e(t){d+=t,d>b.byteLength&&(b=ArrayBuffer.transfer(b,Math.max(2*b.byteLength,d)),p=new DataView(b))}function n(t){t>>>=0,e(4),p.setUint32(u,t,!1),u=d}function s(t){t>>>=0,e(3),p.setUint8(u,t>>16&255),p.setUint8(u+1,t>>8&255),p.setUint8(u+2,255&t),u=d}function i(t){t>>>=0,e(2),p.setUint16(u,t,!1),u=d}function h(t){t>>>=0,e(1),p.setUint8(u,t),u=d}function o(t,n){n=n>>>0&127|(1&t)<<7,e(1),p.setUint8(u,n),u=d}function a(t){if(t>>>=0,t>268435455)throw new Error("writeVariableLength value too big.");for(var e=!1,n=0;4>n;n++){var s=21-7*n,i=t>>>s&127;0==i&&3!=n||(e=!0),e&&o(3==n?0:1,i)}}function l(t){a(t.length);for(var e=0;e<t.length;e++){var n=t.charCodeAt(e);if(n>127)throw new Error("Trying to write unicode character as ascii.");h(n)}}var u=0,d=0,b=new ArrayBuffer(1024),p=new DataView(b),f=c.Mc.song,g=96,v=g/f.parts,m=v/4,M=60,y=1e6*M,w=f.getBeatsPerMinute(),A=Math.round(y/w),x=M/(g*w),C=g*f.beats,E=[];if(c.$e.checked)for(var k=0;k<f.loopStart;k++)E.push(k);for(var j=0;j<Number(c._e.value);j++)for(var k=f.loopStart;k<f.loopStart+f.loopLength;k++)E.push(k);if(c.af.checked)for(var k=f.loopStart+f.loopLength;k<f.bars;k++)E.push(k);var S=[{isMeta:!0,channel:-1,midiChannel:-1,isChorus:!1,isDrums:!1},{isMeta:!1,channel:0,midiChannel:0,isChorus:!1,isDrums:!1},{isMeta:!1,channel:0,midiChannel:1,isChorus:!0,isDrums:!1},{isMeta:!1,channel:1,midiChannel:2,isChorus:!1,isDrums:!1},{isMeta:!1,channel:1,midiChannel:3,isChorus:!0,isDrums:!1},{isMeta:!1,channel:2,midiChannel:4,isChorus:!1,isDrums:!1},{isMeta:!1,channel:2,midiChannel:5,isChorus:!0,isDrums:!1},{isMeta:!1,channel:3,midiChannel:6,isChorus:!1,isDrums:!0}];n(1297377380),n(6),i(1),i(S.length),i(g);for(var P=function(e){n(1297379947);var r=e.isMeta,b=e.channel,g=e.midiChannel,M=e.isChorus,y=e.isDrums,w=u;d+=4,u=d;var k=0,j=0,S=function(t){if(k>t)throw new Error("Midi event time cannot go backwards.");a(t-k),k=t};if(r){S(0),i(65281),l("http://www.beepbox.co/#"+f.toString()),S(0),s(16732419),s(A),S(0),s(16734212),h(f.beats),h(2),h(24),h(8);var P=f.scale<10&&1==(1&f.scale),T=11-f.key,L=T;for(1==(1&T)&&(L+=6),P&&(L+=9);L>6;)L-=12;S(0),s(16734466),h(L),h(P?1:0),c.$e.checked&&(j+=C*f.loopStart),S(j),i(65286),l("Loop Start");for(var B=0;B<Number(c._e.value);B++)j+=C*f.loopLength,S(j),i(65286),l(B<Number(c._e.value)-1?"Loop Repeat":"Loop End");if(c.af.checked&&(j+=C*(f.bars-f.loopStart-f.loopLength)),j!=C*E.length)throw new Error("Miscalculated number of bars.")}else{var I=["blue channel","yellow channel","orange channel","gray channel"][b];M&&(I+=" chorus"),S(0),i(65283),l(I),S(j),h(176|g),o(0,126),o(0,1),S(j),h(176|g),o(0,68),o(0,127);for(var N=-1,R=-1,D=-1,V=y?33:t.Music.keyTransposes[f.key],Z=y?t.Music.drumInterval:1,G=0,U=E;G<U.length;G++){var F=U[G],Y=f.getPattern(b,F);if(null!=Y){var O=Y.instrument;if(M&&0==f.instrumentChorus[b][O]){j+=C;continue}if(N!=O){if(N=O,S(j),i(65284),y){var W="noise: "+t.Music.drumNames[f.instrumentWaves[b][O]];W+=", volume: "+t.Music.volumeNames[f.instrumentVolumes[b][O]],W+=", envelope: "+t.Music.attackNames[f.instrumentAttacks[b][O]],l(W),S(j),h(192|g),o(0,126)}else{var W="wave: "+t.Music.waveNames[f.instrumentWaves[b][O]];W+=", volume: "+t.Music.volumeNames[f.instrumentVolumes[b][O]],W+=", envelope: "+t.Music.attackNames[f.instrumentAttacks[b][O]],W+=", filter: "+t.Music.filterNames[f.instrumentFilters[b][O]],W+=", chorus: "+t.Music.chorusNames[f.instrumentChorus[b][O]],W+=", effect: "+t.Music.effectNames[f.instrumentEffects[b][O]],l(W);var z=[71,80,70,68,81,81,81,81,74],J=[46,46,6,24,25,25,106,106,33],X=f.instrumentFilters[b][O]<3?z:J;S(j),h(192|g),o(0,X[f.instrumentWaves[b][O]])}var _=f.instrumentVolumes[b][O],Q=(5-_)/5;S(j),h(176|g),o(0,7),o(0,Math.round(127*Q))}var q=f.instrumentEffects[b][O],H=t.Music.effectVibratos[q],K=t.Music.effectTremelos[q],$=.14,tt=t.Music.chorusValues[f.instrumentChorus[b][O]];M||(tt*=-1),tt+=t.Music.chorusOffsets[f.instrumentChorus[b][O]];for(var et=0;et<Y.tones.length;et++){for(var nt=Y.tones[et],st=j+nt.start*v,it=st,rt=nt.pins[0].volume,ht=nt.pins[0].interval,ot=V+nt.notes[0]*Z,at=1;at<nt.pins.length;at++){for(var ct=st+nt.pins[at].time*v,lt=nt.pins[at].volume,ut=nt.pins[at].interval,dt=ct-it,bt=0;dt>bt;bt++){var pt=it+bt,ft=t.lerp(rt,lt,bt/dt),gt=t.lerp(ht,ut,bt/dt),vt=Math.floor(bt/m)%4,mt=void 0;mt=2==nt.notes.length?nt.notes[vt>>1]:3==nt.notes.length?nt.notes[3==vt?1:vt]:4==nt.notes.length?nt.notes[vt]:nt.notes[0];var Mt=V+mt*Z+gt+tt;mt=Math.round(Mt);var yt=Mt-mt,wt=Math.sin(2*Math.PI*(pt-j)*x/$);(2!=q||pt-st>=3*v)&&(yt+=H*wt);var At=Math.max(0,Math.min(16383,Math.round(8192+4096*yt))),xt=ft/3,Ct=1+K*(wt-1),Et=Math.round(127*xt*Ct);At!=R&&(S(pt),h(224|g),o(0,127&At),o(0,At>>7&127),R=At),Et!=D&&(S(pt),h(176|g),o(0,11),o(0,Et),D=Et),pt==st?(S(pt),h(144|g),o(0,mt),o(0,64)):mt!=ot&&(S(pt),h(144|g),o(0,mt),o(0,64),S(pt),h(128|g),o(0,ot),o(0,64)),ot=mt}it=ct,rt=lt,ht=ut}S(j+nt.end*v),h(128|g),o(0,ot),o(0,64)}}j+=C}}S(j),s(16723712),p.setUint32(w,u-w-4,!1)},T=0,L=S;T<L.length;T++){var B=L[T];P(B)}b=ArrayBuffer.transfer(b,d);var I=new Blob([b],{type:"audio/midi"});r(I,c.Ze.value.trim()+".midi"),c.Ue()},this.hf=function(){var t=c.Mc.song.toJsonObject(c.$e.checked,Number(c._e.value),c.af.checked),e=JSON.stringify(t,null,"	"),n=new Blob([e],{type:"application/json"});r(n,c.Ze.value.trim()+".json"),c.Ue()},this._e.value="1",0==this.Mc.song.loopStart?(this.$e.checked=!1,this.$e.disabled=!0):(this.$e.checked=!0,this.$e.disabled=!1),this.Mc.song.loopStart+this.Mc.song.loopLength==this.Mc.song.bars?(this.af.checked=!1,this.af.disabled=!0):(this.af.checked=!0,this.af.disabled=!1),this.Ze.addEventListener("input",h.ef),this._e.addEventListener("blur",h.Xe),this.bf.addEventListener("click",this.ff),this.cf.addEventListener("click",this.gf),this.df.addEventListener("click",this.hf),this.Te.addEventListener("click",this.Ue)}return h.ef=function(t){var e=t.target,n=/[\+\*\$\?\|\{\}\\\/<>#%!`&'"=:@]/gi;if(n.test(e.value)){var s=e.selectionStart;e.value=e.value.replace(n,""),s--,e.setSelectionRange(s,s)}},h.Xe=function(t){var e=t.target;e.value=Math.floor(Math.max(Number(e.min),Math.min(Number(e.max),Number(e.value))))+""},h}();t.ExportPrompt=h}(beepbox||(beepbox={}));var beepbox;!function(t){var e=t.html.button,n=t.html.div,s=t.html.input,i=t.html.text,r=function(){function r(r,h){var o=this;this.Mc=r,this.Ud=h,this.if=s({type:"file",accept:".json,application/json"}),this.Te=e({},[i("Cancel")]),this.container=n({className:"prompt",style:"width: 200px;"},[n({style:"font-size: 2em"},[i("Import")]),n(void 0,[i("BeepBox songs can be exported and re-imported as .json files. You could also use other means to make .json files for BeepBox as long as they follow the same structure.")]),this.if,this.Te]),this.Ue=function(){o.Ud.closePrompt(o),o.if.removeEventListener("change",o.jf),o.Te.removeEventListener("click",o.Ue)},this.jf=function(){var e=o.if.files[0];if(e){var n=new FileReader;n.addEventListener("load",function(e){o.Mc.history.record(new t.ChangeSong(o.Mc,new t.Song(n.result))),o.Ue()}),n.readAsText(e)}},this.if.addEventListener("change",this.jf),this.Te.addEventListener("click",this.Ue)}return r}();t.ImportPrompt=r}(beepbox||(beepbox={}));var beepbox;!function(t){function e(t,e){for(var n=0,s=e;n<s.length;n++){var i=s[n];t.appendChild(c(i,i,!1,!1))}return t}function n(t,e){t.selectedIndex!=e&&(t.selectedIndex=e)}function s(){p!=location.hash&&(p=location.hash,""!=p&&f.history.record(new t.ChangeSong(f,new t.Song(p)))),g||document.hidden||(g=!0,/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|android|ipad|playbook|silk/i.test(navigator.userAgent)||f.synth.play(),f.changed()),t.Model.updateAll(),window.requestAnimationFrame(s)}function i(){var t="#"+f.song.toString();location.hash!=t&&(location.hash=t,p=t)}var r=t.html.button,h=t.html.div,o=t.html.span,a=t.html.select,c=t.html.option,l=t.html.input,u=t.html.text,d=function(){function s(i){var d=this;this.Mc=i,this.promptVisible=!1,this.kf=700,this.lf=645,this.mf=new t.PatternEditor(this.Mc),this.nf=new t.TrackEditor(this.Mc,this),this.pf=new t.LoopEditor(this.Mc),this.qf=new t.BarScrollBar(this.Mc),this.rf=new t.OctaveScrollBar(this.Mc),this.sf=new t.Piano(this.Mc),this.tf=h({style:"width: 512px; height: 645px;"},[h({style:"width: 512px; height: 481px; display: flex; flex-direction: row;"},[this.sf.container,this.mf.container,this.rf.container]),h({style:"width: 512px; height: 6px;"}),h({style:"width: 512px; height: 158px;"},[this.nf.container,h({style:"width: 512px; height: 5px;"}),this.pf.container,h({style:"width: 512px; height: 5px;"}),this.qf.container])]),this.uf=r({style:"width: 34px; margin: 0px",type:"button"}),this.vf=l({style:"width: 9em; flex-shrink: 0; margin: 0px;",type:"range",min:"0",max:"100",value:"50",step:"1"}),this.wf=a({style:"width:100%;"},[c("","Edit Menu",!0,!0),c("undo","Undo (Z)",!1,!1),c("redo","Redo (Y)",!1,!1),c("copy","Copy Pattern (C)",!1,!1),c("paste","Paste Pattern (V)",!1,!1),c("transposeUp","Shift Notes Up (+)",!1,!1),c("transposeDown","Shift Notes Down (-)",!1,!1),c("duration","Custom song size...",!1,!1),c("import","Import JSON...",!1,!1),c("clean","Clean Slate",!1,!1)]),this.xf=a({style:"width:100%;"},[c("","Preferences Menu",!0,!0),c("showLetters","Show Piano",!1,!1),c("showFifth","Highlight 'Fifth' Notes",!1,!1),c("showChannels","Show All Channels",!1,!1),c("showScrollBar","Octave Scroll Bar",!1,!1)]),this.yf=r({style:"margin: 5px 0;",type:"button"},[u("Export")]),this.zf=e(a({style:"width:9em;"}),t.Music.scaleNames),this.Af=e(a({style:"width:9em;"}),t.Music.keyNames),this.Bf=l({style:"width: 9em; margin: 0px;",type:"range",min:"0",max:"11",value:"7",step:"1"}),this.Cf=l({style:"width: 9em; margin: 0px;",type:"range",min:"0",max:"3",value:"0",step:"1"}),this.Df=e(a({style:"width:9em;"}),t.Music.partNames),this.Ef=h({style:"visibility: hidden; margin: 3px 0; text-align: center;"},[u("Pattern Settings")]),this.Ff=a({style:"width:9em;"}),this.Gf=h({className:"selectRow",style:"visibility: hidden;"},[o({},[u("Instrument: ")]),h({className:"selectContainer"},[this.Ff])]),this.Hf=h({style:"margin: 3px 0; text-align: center;"},[u("Instrument Settings")]),this.If=l({style:"width: 9em; margin: 0px;",type:"range",min:"-5",max:"0",value:"0",step:"1"}),this.Jf=e(a({style:"width:9em;"}),t.Music.waveNames),this.Kf=e(a({style:"width:9em;"}),t.Music.drumNames),this.Lf=e(a({style:"width:9em;"}),t.Music.attackNames),this.Mf=e(a({style:"width:9em;"}),t.Music.filterNames),this.Nf=h({className:"selectRow"},[o({},[u("Filter: ")]),h({
className:"selectContainer"},[this.Mf])]),this.Of=e(a({style:"width:9em;"}),t.Music.chorusNames),this.Pf=h({className:"selectRow"},[o({},[u("Chorus: ")]),h({className:"selectContainer"},[this.Of])]),this.Qf=e(a({style:"width:9em;"}),t.Music.effectNames),this.Rf=h({className:"selectRow"},[o({},[u("Effect: ")]),h({className:"selectContainer"},[this.Qf])]),this.Sf=h({},[h({className:"selectRow"},[o({},[u("Volume: ")]),this.If]),h({className:"selectRow"},[o({},[u("Wave: ")]),h({className:"selectContainer"},[this.Jf,this.Kf])]),h({className:"selectRow"},[o({},[u("Envelope: ")]),h({className:"selectContainer"},[this.Lf])]),this.Nf,this.Pf,this.Rf]),this.Tf=h({className:"promptContainer",style:"display: none;"}),this.mainLayer=h({className:"beepboxEditor",tabIndex:"0"},[this.tf,h({className:"editor-right-side"},[h({style:"text-align: center; color: #999;"},[u("BeepBox 2.1.3")]),h({style:"margin: 5px 0; display: flex; flex-direction: row; align-items: center;"},[this.uf,h({style:"width: 1px; height: 10px;"}),t.svgElement("svg",{width:"2em",height:"2em",viewBox:"0 0 26 26"},[t.svgElement("path",{d:"M 4 17 L 4 9 L 8 9 L 12 5 L 12 21 L 8 17 z",fill:"#777"}),t.svgElement("path",{d:"M 15 11 L 16 10 A 7.2 7.2 0 0 1 16 16 L 15 15 A 5.8 5.8 0 0 0 15 12 z",fill:"#777"}),t.svgElement("path",{d:"M 18 8 L 19 7 A 11.5 11.5 0 0 1 19 19 L 18 18 A 10.1 10.1 0 0 0 18 8 z",fill:"#777"})]),h({style:"width: 1px; height: 10px;"}),this.vf]),h({className:"selectContainer",style:"margin: 5px 0;"},[this.wf]),h({className:"selectContainer",style:"margin: 5px 0;"},[this.xf]),this.yf,h({style:"flex: 1 1 110px;"}),h({style:"margin: 3px 0; text-align: center;"},[u("Song Settings")]),h({className:"selectRow"},[o({},[u("Scale: ")]),h({className:"selectContainer"},[this.zf])]),h({className:"selectRow"},[o({},[u("Key: ")]),h({className:"selectContainer"},[this.Af])]),h({className:"selectRow"},[o({},[u("Tempo: ")]),this.Bf]),h({className:"selectRow"},[o({},[u("Reverb: ")]),this.Cf]),h({className:"selectRow"},[o({},[u("Rhythm: ")]),h({className:"selectContainer"},[this.Df])]),h({style:"flex: 1 1 25px;"}),this.Ef,this.Gf,h({style:"flex: 1 1 25px;"}),this.Hf,this.Sf]),this.Tf]),this.Uf=0,this.Vf=0,this.Wf=!1,this.Xf=function(t){d.mainLayer.focus()},this.Yf=function(){for(var i=[(d.Mc.showLetters?"✓ ":"")+"Show Piano",(d.Mc.showFifth?"✓ ":"")+"Highlight 'Fifth' Notes",(d.Mc.showChannels?"✓ ":"")+"Show All Channels",(d.Mc.showScrollBar?"✓ ":"")+"Octave Scroll Bar"],r=0;r<i.length;r++){var h=d.xf.children[r+1];h.innerText!=i[r]&&(h.innerText=i[r])}n(d.zf,d.Mc.song.scale),n(d.Af,d.Mc.song.key),d.Bf.value=""+d.Mc.song.tempo,d.Cf.value=""+d.Mc.song.reverb,n(d.Df,t.Music.partCounts.indexOf(d.Mc.song.parts)),3==d.Mc.channel?(d.Nf.style.visibility="hidden",d.Pf.style.visibility="hidden",d.Rf.style.visibility="hidden",d.Jf.style.display="none",d.Kf.style.display="block"):(d.Nf.style.visibility="visible",d.Pf.style.visibility="visible",d.Rf.style.visibility="visible",d.Jf.style.display="block",d.Kf.style.display="none");var o=d.Mc.getCurrentPattern();if(d.Ef.style.visibility=d.Mc.song.instruments>1&&null!=o?"visible":"hidden",d.Gf.style.visibility=d.Mc.song.instruments>1&&null!=o?"visible":"hidden",d.Ff.children.length!=d.Mc.song.instruments){for(;d.Ff.firstChild;)d.Ff.removeChild(d.Ff.firstChild);for(var a=[],r=0;r<d.Mc.song.instruments;r++)a.push(r+1);e(d.Ff,a)}d.Sf.style.color=s.noteColorsBright[d.Mc.channel];var c=d.Mc.getCurrentInstrument();n(d.Jf,d.Mc.song.instrumentWaves[d.Mc.channel][c]),n(d.Kf,d.Mc.song.instrumentWaves[d.Mc.channel][c]),n(d.Mf,d.Mc.song.instrumentFilters[d.Mc.channel][c]),n(d.Lf,d.Mc.song.instrumentAttacks[d.Mc.channel][c]),n(d.Qf,d.Mc.song.instrumentEffects[d.Mc.channel][c]),n(d.Of,d.Mc.song.instrumentChorus[d.Mc.channel][c]),d.If.value=-d.Mc.song.instrumentVolumes[d.Mc.channel][c]+"",n(d.Ff,c),d.sf.container.style.display=d.Mc.showLetters?"block":"none",d.rf.container.style.display=d.Mc.showScrollBar?"block":"none",d.qf.container.style.display=d.Mc.song.bars>16?"block":"none";var l=512;d.Mc.showLetters&&(l-=32),d.Mc.showScrollBar&&(l-=20),d.mf.container.style.width=String(l)+"px";var u=128;d.Mc.song.bars>16&&(u-=20),d.nf.container.style.height=String(u)+"px",d.vf.value=String(d.Mc.volume),d.Zf()},this.$f=function(t){if(!d.promptVisible)switch(d.nf.onKeyPressed(t),t.keyCode){case 32:d._f(),t.preventDefault();break;case 90:t.shiftKey?d.Mc.history.redo():d.Mc.history.undo(),t.preventDefault();break;case 89:d.Mc.history.redo(),t.preventDefault();break;case 67:d.ag(),t.preventDefault();break;case 86:d.bg(),t.preventDefault();break;case 219:d.Mc.synth.prevBar(),t.preventDefault();break;case 221:d.Mc.synth.nextBar(),t.preventDefault();break;case 71:d.Mc.synth.stutterPressed=!0,t.preventDefault();break;case 189:case 173:d.cg(!1),t.preventDefault();break;case 187:case 61:d.cg(!0),t.preventDefault()}},this.dg=function(t){switch(t.keyCode){case 71:d.Mc.synth.stutterPressed=!1}},this._f=function(){d.Mc.synth.playing?(d.Mc.synth.pause(),d.Mc.synth.snapToBar()):d.Mc.synth.play(),d.Zf()},this.eg=function(){d.Mc.setVolume(Number(d.vf.value))},this.fg=function(){d.gg(new t.ExportPrompt(d.Mc,d))},this.hg=function(){d.Mc.history.record(new t.ChangeScale(d.Mc,d.zf.selectedIndex))},this.ig=function(){d.Mc.history.record(new t.ChangeKey(d.Mc,d.Af.selectedIndex))},this.jg=function(){d.Mc.history.record(new t.ChangeTempo(d.Mc,parseInt(d.Bf.value)))},this.kg=function(){d.Mc.history.record(new t.ChangeReverb(d.Mc,parseInt(d.Cf.value)))},this.lg=function(){d.Mc.history.record(new t.ChangeParts(d.Mc,t.Music.partCounts[d.Df.selectedIndex]))},this.mg=function(){d.Mc.history.record(new t.ChangeWave(d.Mc,d.Jf.selectedIndex))},this.ng=function(){d.Mc.history.record(new t.ChangeWave(d.Mc,d.Kf.selectedIndex))},this.og=function(){d.Mc.history.record(new t.ChangeFilter(d.Mc,d.Mf.selectedIndex))},this.pg=function(){d.Mc.history.record(new t.ChangeAttack(d.Mc,d.Lf.selectedIndex))},this.qg=function(){d.Mc.history.record(new t.ChangeEffect(d.Mc,d.Qf.selectedIndex))},this.rg=function(){d.Mc.history.record(new t.ChangeChorus(d.Mc,d.Of.selectedIndex))},this.sg=function(){d.Mc.history.record(new t.ChangeVolume(d.Mc,-parseInt(d.If.value)))},this.tg=function(){null!=d.Mc.getCurrentPattern()&&d.Mc.history.record(new t.ChangePatternInstrument(d.Mc,d.Ff.selectedIndex))},this.ug=function(e){switch(d.wf.value){case"undo":d.Mc.history.undo();break;case"redo":d.Mc.history.redo();break;case"copy":d.ag();break;case"paste":d.bg();break;case"transposeUp":d.cg(!0);break;case"transposeDown":d.cg(!1);break;case"import":d.gg(new t.ImportPrompt(d.Mc,d));break;case"clean":d.vg();break;case"duration":d.gg(new t.SongDurationPrompt(d.Mc,d))}d.wf.selectedIndex=0},this.wg=function(t){switch(d.xf.value){case"showLetters":d.Mc.showLetters=!d.Mc.showLetters;break;case"showFifth":d.Mc.showFifth=!d.Mc.showFifth;break;case"showChannels":d.Mc.showChannels=!d.Mc.showChannels;break;case"showScrollBar":d.Mc.showScrollBar=!d.Mc.showScrollBar}d.xf.selectedIndex=0,d.Mc.changed(),d.Mc.savePreferences()},this.Mc.watch(this.Yf),this.Yf(),this.wf.addEventListener("change",this.ug),this.xf.addEventListener("change",this.wg),this.zf.addEventListener("change",this.hg),this.Af.addEventListener("change",this.ig),this.Bf.addEventListener("input",this.jg),this.Cf.addEventListener("input",this.kg),this.Df.addEventListener("change",this.lg),this.Ff.addEventListener("change",this.tg),this.If.addEventListener("input",this.sg),this.Jf.addEventListener("change",this.mg),this.Kf.addEventListener("change",this.ng),this.Lf.addEventListener("change",this.pg),this.Mf.addEventListener("change",this.og),this.Of.addEventListener("change",this.rg),this.Qf.addEventListener("change",this.qg),this.uf.addEventListener("click",this._f),this.yf.addEventListener("click",this.fg),this.vf.addEventListener("input",this.eg),this.tf.addEventListener("mousedown",this.Xf),this.mainLayer.addEventListener("keydown",this.$f),this.mainLayer.addEventListener("keyup",this.dg)}return s.prototype.gg=function(t){this.promptVisible||(this.xg=this.Mc.synth.playing,this.xg&&this._f(),this.Tf.style.display=null,this.Tf.appendChild(t.container),this.promptVisible=!0)},s.prototype.closePrompt=function(t){this.promptVisible=!1,this.xg&&this._f(),this.Tf.style.display="none",this.Tf.removeChild(t.container),this.mainLayer.focus()},s.prototype.Zf=function(){this.Mc.synth.playing?(this.uf.classList.remove("playButton"),this.uf.classList.add("pauseButton")):(this.uf.classList.remove("pauseButton"),this.uf.classList.add("playButton"))},s.prototype.ag=function(){var t=this.Mc.getCurrentPattern();null!=t&&(this.yg=t.cloneTones(),this.Uf=this.Mc.song.beats,this.Vf=this.Mc.song.parts,this.Wf=3==this.Mc.channel)},s.prototype.bg=function(){this.zg()&&this.Mc.history.record(new t.ChangePaste(this.Mc,this.yg))},s.prototype.zg=function(){return null!=this.Mc.getCurrentPattern()&&null!=this.yg&&this.Uf==this.Mc.song.beats&&this.Vf==this.Mc.song.parts&&this.Wf==(3==this.Mc.channel)},s.prototype.vg=function(){this.Mc.history.record(new t.ChangeSong(this.Mc,new t.Song)),this.mf.resetCopiedPins()},s.prototype.cg=function(e){var n=this.Mc.getCurrentPattern();null!=n&&this.Mc.history.record(new t.ChangeTranspose(this.Mc,n,e))},s}();d.channelColorsDim=["#0099a1","#a1a100","#c75000","#6f6f6f"],d.channelColorsBright=["#25f3ff","#ffff25","#ff9752","#aaaaaa"],d.noteColorsDim=["#00bdc7","#c7c700","#ff771c","#aaaaaa"],d.noteColorsBright=["#92f9ff","#ffff92","#ffcdab","#eeeeee"],t.SongEditor=d;var b=document.createElement("style");b.type="text/css",b.appendChild(document.createTextNode('\n.beepboxEditor {\n	/* For some reason the default focus outline effect causes the entire editor to get repainted when any part of it changes. Border doesn\'t do that. */\n	margin: -3px;\n	border: 3px solid transparent;\n	width: 700px;\n	height: 645px;\n	display: flex;\n	flex-direction: row;\n	-webkit-touch-callout: none;\n	-webkit-user-select: none;\n	-khtml-user-select: none;\n	-moz-user-select: none;\n	-ms-user-select: none;\n	user-select: none;\n	position: relative;\n	touch-action: manipulation;\n	cursor: default;\n	font-size: small;\n}\n.beepboxEditor:focus {\n	outline: none;\n	border-color: #555;\n}\n\n.beepboxEditor div {\n	margin: 0;\n	padding: 0;\n}\n\n.beepboxEditor .promptContainer {\n	position: absolute;\n	top: 0;\n	left: 0;\n	width: 100%;\n	height: 100%;\n	background: rgba(0,0,0,0.5);\n	display: flex;\n	justify-content: center;\n	align-items: center;\n}\n\n.beepboxEditor .prompt {\n	margin: auto;\n	text-align: center;\n	background: #000;\n	border-radius: 15px;\n	border: 4px solid #444;\n	color: #fff;\n	padding: 20px;\n	display: flex;\n	flex-direction: column;\n}\n\n.beepboxEditor .prompt > *:not(:first-child) {\n	margin-top: 1.5em;\n}\n\n/* Use psuedo-elements to add cross-browser up & down arrows to select elements: */\n.beepboxEditor .selectContainer {\n	position: relative;\n}\n.beepboxEditor .selectContainer::before {\n	content: "";\n	position: absolute;\n	right: 0.5em;\n	top: 0.4em;\n	border-bottom: 0.4em solid currentColor;\n	border-left: 0.3em solid transparent;\n	border-right: 0.3em solid transparent;\n	pointer-events: none;\n}\n.beepboxEditor .selectContainer::after {\n	content: "";\n	position: absolute;\n	right: 0.5em;\n	bottom: 0.4em;\n	border-top: 0.4em solid currentColor;\n	border-left: 0.3em solid transparent;\n	border-right: 0.3em solid transparent;\n	pointer-events: none;\n}\n.beepboxEditor select {\n	margin: 0;\n	padding: 0 0.5em;\n	display: block;\n	height: 2em;\n	border: none;\n	border-radius: 0.4em;\n	background: #444444;\n	color: inherit;\n	font-size: inherit;\n	cursor: pointer;\n	\n	-webkit-appearance:none;\n	-moz-appearance: none;\n	appearance: none;\n}\n.beepboxEditor select:focus {\n	background: #777777;\n	outline: none;\n}\n/* This makes it look better in firefox on my computer... What about others?\n@-moz-document url-prefix() {\n    .beepboxEditor select { padding: 0 2px; }\n}\n*/\n.beepboxEditor button {\n	margin: 0;\n	position: relative;\n	height: 2em;\n	border: none;\n	border-radius: 0.4em;\n	background: #444;\n	color: inherit;\n	font-size: inherit;\n	cursor: pointer;\n}\n.beepboxEditor button:focus {\n	background: #777;\n	outline: none;\n}\n.beepboxEditor button.playButton::before {\n	content: "";\n	position: absolute;\n	left: 50%;\n	top: 50%;\n	margin-left: -0.45em;\n	margin-top: -0.65em;\n	border-left: 1em solid currentColor;\n	border-top: 0.65em solid transparent;\n	border-bottom: 0.65em solid transparent;\n	pointer-events: none;\n}\n.beepboxEditor button.pauseButton::before {\n	content: "";\n	position: absolute;\n	left: 50%;\n	top: 50%;\n	margin-left: -0.5em;\n	margin-top: -0.65em;\n	width: 0.3em;\n	height: 1.3em;\n	background: currentColor;\n	pointer-events: none;\n}\n.beepboxEditor button.pauseButton::after {\n	content: "";\n	position: absolute;\n	left: 50%;\n	top: 50%;\n	margin-left: 0.2em;\n	margin-top: -0.65em;\n	width: 0.3em;\n	height: 1.3em;\n	background: currentColor;\n	pointer-events: none;\n}\n\n.beepboxEditor canvas {\n	overflow: hidden;\n	position: absolute;\n	display: block;\n}\n\n.beepboxEditor .selectRow {\n	margin: 0;\n	height: 2.5em;\n	display: flex;\n	flex-direction: row;\n	align-items: center;\n	justify-content: space-between;\n}\n\n.beepboxEditor .selectRow > span {\n	color: #999;\n}\n\n.beepboxEditor .editor-right-side {\n	margin-left: 6px;\n	width: 182px;\n	height: 645px;\n	display: flex;\n	flex-direction: column;\n}\n\n.beepboxEditor .editor-right-side > * {\n	flex-shrink: 0;\n}\n\n.beepboxEditor input[type=text], .beepboxEditor input[type=number] {\n	font-size: inherit;\n	background: transparent;\n	border: 1px solid #777;\n	color: white;\n}\n\n.beepboxEditor input[type=checkbox] {\n  transform: scale(1.5);\n}\n\n.beepboxEditor input[type=range] {\n	-webkit-appearance: none;\n	color: inherit;\n	width: 100%;\n	height: 2em;\n	font-size: inherit;\n	margin: 0;\n	cursor: pointer;\n	background-color: black;\n}\n.beepboxEditor input[type=range]:focus {\n	outline: none;\n}\n.beepboxEditor input[type=range]::-webkit-slider-runnable-track {\n	width: 100%;\n	height: 0.5em;\n	cursor: pointer;\n	background: #444;\n}\n.beepboxEditor input[type=range]::-webkit-slider-thumb {\n	height: 2em;\n	width: 0.5em;\n	border-radius: 0.25em;\n	background: currentColor;\n	cursor: pointer;\n	-webkit-appearance: none;\n	margin-top: -0.75em;\n}\n.beepboxEditor input[type=range]:focus::-webkit-slider-runnable-track {\n	background: #777;\n}\n.beepboxEditor input[type=range]::-moz-range-track {\n	width: 100%;\n	height: 0.5em;\n	cursor: pointer;\n	background: #444;\n}\n.beepboxEditor input[type=range]:focus::-moz-range-track {\n	background: #777;\n}\n.beepboxEditor input[type=range]::-moz-range-thumb {\n	height: 2em;\n	width: 0.5em;\n	border-radius: 0.25em;\n	border: none;\n	background: currentColor;\n	cursor: pointer;\n}\n.beepboxEditor input[type=range]::-ms-track {\n	width: 100%;\n	height: 0.5em;\n	cursor: pointer;\n	background: #444;\n	border-color: transparent;\n}\n.beepboxEditor input[type=range]:focus::-ms-track {\n	background: #777;\n}\n.beepboxEditor input[type=range]::-ms-thumb {\n	height: 2em;\n	width: 0.5em;\n	border-radius: 0.25em;\n	background: currentColor;\n	cursor: pointer;\n}\n')),document.head.appendChild(b);var p="**blank**",f=new t.SongDocument,g=!1,v=new d(f),m=document.getElementById("beepboxEditorContainer");m.appendChild(v.mainLayer),v.mainLayer.focus(),f.history.watch(i),s()}(beepbox||(beepbox={}));
</script>

</body></html>
